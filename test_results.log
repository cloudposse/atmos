[1;38;5;86mINFO[0m Smoke tests for atmos CLI starting
[1;38;5;86mINFO[0m Starting directory [2mdir[0m[2m=[0m/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests
atmos_cli_config:
  base_path: ./
  components:
    terraform:
      base_path: ../../components/terraform
      apply_auto_approve: false
      append_user_agent: Atmos/test (Cloud Posse; +https://atmos.tools)
      deploy_run_init: true
      init_run_reconfigure: true
      auto_generate_backend_file: false
      command: ""
      shell:
        prompt: ""
      init:
        pass_vars: false
      plan:
        skip_planfile: false
    helmfile:
      base_path: ""
      use_eks: true
      kubeconfig_path: ""
      helm_aws_profile_pattern: ""
      cluster_name_pattern: ""
      command: ""
    packer:
      base_path: ""
      command: ""
  stacks:
    base_path: stacks
    included_paths:
      - deploy/**/*
    excluded_paths:
      - '**/_defaults.yaml'
    name_pattern: '{stage}'
    name_template: ""
  workflows:
    base_path: ""
    list:
      format: ""
      columns: []
atmos_component: component-1
atmos_manifest: deploy/nonprod
atmos_stack: nonprod
atmos_stack_file: deploy/nonprod
backend: {}
backend_type: ""
cli_args:
  - describe
  - component
command: terraform
component: yaml-functions
component_info:
  component_path: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions
  component_type: terraform
  terraform_config:
    path: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions
    variables:
      boolean_var:
        name: boolean_var
        type: bool
        description: Boolean variable
        default: false
        required: false
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/variables.tf
          line: 12
      list_var:
        name: list_var
        type: list(string)
        description: List variable
        default: []
        required: false
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/variables.tf
          line: 18
      map_var:
        name: map_var
        type: map(string)
        description: Map variable
        default: {}
        required: false
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/variables.tf
          line: 24
      stage:
        name: stage
        type: string
        description: Stage where it will be deployed
        default: null
        required: true
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/variables.tf
          line: 1
      string_var:
        name: string_var
        type: string
        description: String variable
        default: test
        required: false
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/variables.tf
          line: 6
    outputs:
      boolean_var:
        name: boolean_var
        description: Boolean output
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/outputs.tf
          line: 6
        type: ""
      list_var:
        name: list_var
        description: List output
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/outputs.tf
          line: 11
        type: ""
      map_var:
        name: map_var
        description: Map output
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/outputs.tf
          line: 16
        type: ""
      string_var:
        name: string_var
        description: String output
        sensitive: false
        pos:
          filename: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/yaml-functions/outputs.tf
          line: 1
        type: ""
    requiredcore: []
    requiredproviders: {}
    providerconfigs: {}
    managedresources: {}
    dataresources: {}
    modulecalls: {}
    diagnostics: []
component_type: terraform
deps:
  - deploy/nonprod
  - mixins/stage/nonprod
deps_all:
  - deploy/nonprod
  - mixins/stage/nonprod
env: {}
hooks: {}
imports:
  - mixins/stage/nonprod
inheritance: []
metadata:
  component: yaml-functions
overrides: {}
providers: {}
remote_state_backend: {}
remote_state_backend_type: ""
settings:
  config:
    a: component-1-a
    b: component-1-b
    c: component-1-c
sources:
  backend: {}
  env: {}
  settings:
    config:
      final_value:
        a: component-1-a
        b: component-1-b
        c: component-1-c
      name: config
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: settings
          variable_value:
            a: component-1-a
            b: component-1-b
            c: component-1-c
  vars:
    boolean_var:
      final_value: true
      name: boolean_var
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value: true
    list_var:
      final_value:
        - a
        - b
        - c
      name: list_var
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value:
            - a
            - b
            - c
    map_var:
      final_value:
        a: 1
        b: 2
        c: 3
      name: map_var
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value:
            a: 1
            b: 2
            c: 3
    stage:
      final_value: nonprod
      name: stage
      stack_dependencies:
        - dependency_type: import
          stack_file: mixins/stage/nonprod
          stack_file_section: vars
          variable_value: nonprod
    string_var:
      final_value: abc
      name: string_var
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value: abc
stack: nonprod
tf_cli_vars: {}
vars:
  boolean_var: true
  list_var:
    - a
    - b
    - c
  map_var:
    a: 1
    b: 2
    c: 3
  stage: nonprod
  string_var: abc
workspace: nonprod-component-1

[1;38;5;86mINFO[0m Atmos runner initialized for test [2mcoverageEnabled[0m[2m=[0mfalse
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-functions/
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-functions/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-include-yaml-function/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-overrides-section/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-overrides-section/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-overrides-section/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-overrides-section/
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/atmos-overrides-section/
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/env
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/exitCode
[1;38;5;86mINFO[0m Setting up sandbox environment [2mworkdir[0m[2m=[0mfixtures/scenarios/metadata
[1;38;5;86mINFO[0m Cleaning directory [2mworkdir[0m[2m=[0mfixtures/scenarios/vendor
--- FAIL: TestCLICommands (323.79s)
    --- FAIL: TestCLICommands/atmos_circuit-breaker (0.08s)
        cli_test.go:874: Reason: stderr did not match pattern "ATMOS_SHLVL exceeds maximum allowed depth. Infinite recursion\\? current=11, max=10".
        cli_test.go:875: Output: "\n# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \nexit status 126                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         \n\n\n"
        cli_test.go:744: Stderr mismatch for test: atmos circuit-breaker
        cli_test.go:1142: Stdout mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_circuit-breaker.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,10 +1 @@
             Hello world!
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m
            [38;5;160m-Hello world![0m

        cli_test.go:1162: Stderr diff mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_circuit-breaker.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,66 +1,6 @@

             # Error

            [38;5;160m-ATMOS_SHLVL exceeds maximum allowed depth. Infinite recursion? current=11, max=10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       [0m
            [38;5;42m+exit status 126                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         [0m


            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           [0m
            [38;5;160m-[0m
            [38;5;160m-[0m

    --- FAIL: TestCLICommands/which_atmos (0.01s)
        cli_test.go:874: Reason: stdout did not match pattern "(build[/\\\\]atmos|atmos/atmos)".
        cli_test.go:875: Output: "/Users/erik/.asdf/shims/atmos\n"
        cli_test.go:739: Stdout mismatch for test: which atmos
    --- FAIL: TestCLICommands/atmos_doesnt_warn_if_not_in_git_repo_with_atmos_config (0.06s)
        cli_test.go:852: Reason: Expected exit code 0, got 1
        cli_test.go:734: Description: Test that atmos doesnt warn if not run inside of a git repo but has an atmos config
        cli_test.go:1142: Stdout mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_doesnt_warn_if_not_in_git_repo_with_atmos_config.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,10 +1,25 @@
            [38;5;160m-tenant1-ue2-dev[0m
            [38;5;160m-tenant1-ue2-prod[0m
            [38;5;160m-tenant1-ue2-staging[0m
            [38;5;160m-tenant1-ue2-test-1[0m
            [38;5;160m-tenant1-uw1-test-1[0m
            [38;5;160m-tenant1-uw2-dev[0m
            [38;5;160m-tenant1-uw2-test-1[0m
            [38;5;160m-tenant2-ue2-dev[0m
            [38;5;160m-tenant2-ue2-prod[0m
            [38;5;160m-tenant2-ue2-staging[0m
            \ No newline at end of file
            [38;5;42m+[0m
            [38;5;42m+Notice: Atmos now collects completely anonymous telemetry regarding usage.[0m
            [38;5;42m+This information is used to shape Atmos roadmap and prioritize features.[0m
            [38;5;42m+You can learn more, including how to opt-out if you'd not like to participate in this anonymous program,[0m
            [38;5;42m+by visiting the following URL: https://atmos.tools/cli/telemetry[0m
            [38;5;42m+[0m
            [38;5;42m+atmos.yaml CLI config file was not found.[0m
            [38;5;42m+[0m
            [38;5;42m+The default Atmos stacks directory is set to atmos/tests/fixtures/scenarios/complete/stacks,[0m
            [38;5;42m+but the directory does not exist in the current path.[0m
            [38;5;42m+[0m
            [38;5;42m+To configure and start using Atmos, refer to the following documents:[0m
            [38;5;42m+[0m
            [38;5;42m+Atmos CLI Configuration:[0m
            [38;5;42m+https://atmos.tools/cli/configuration[0m
            [38;5;42m+[0m
            [38;5;42m+Atmos Components:[0m
            [38;5;42m+https://atmos.tools/core-concepts/components[0m
            [38;5;42m+[0m
            [38;5;42m+Atmos Stacks:[0m
            [38;5;42m+https://atmos.tools/core-concepts/stacks[0m
            [38;5;42m+[0m
            [38;5;42m+Quick Start:[0m
            [38;5;42m+https://atmos.tools/quick-start[0m
            [38;5;42m+[0m

    --- FAIL: TestCLICommands/atmos_vendor_pull#01 (158.14s)
        cli_test.go:852: Reason: Expected exit code 0, got 1
        cli_test.go:734: Description: Ensure atmos vendor pull command executes without errors and files are present.
        cli_test.go:886: Reason: Expected file does not exist: "./components/terraform/myapp1/main.tf"
        cli_test.go:886: Reason: Expected file does not exist: "./components/terraform/myapp1/README.md"
        cli_test.go:757: Description: Ensure atmos vendor pull command executes without errors and files are present.
    --- FAIL: TestCLICommands/atmos_vendor_pull_oci (0.84s)
        cli_test.go:852: Reason: Expected exit code 0, got 1
        cli_test.go:734: Description: Ensure 'atmos vendor pull --tags' command executes without errors and files are present.
        cli_test.go:886: Reason: Expected file does not exist: "./components/terraform/myapp1/main.tf"
        cli_test.go:886: Reason: Expected file does not exist: "./components/terraform/myapp1/README.md"
        cli_test.go:757: Description: Ensure 'atmos vendor pull --tags' command executes without errors and files are present.
    --- FAIL: TestCLICommands/atmos_workflow_success (0.07s)
        cli_test.go:852: Reason: Expected exit code 0, got 1
        cli_test.go:734: Description: Ensure atmos workflow passes
    --- FAIL: TestCLICommands/atmos_workflow_failure (0.07s)
        cli_test.go:1162: Stderr diff mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_workflow_failure.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,11 +1,5 @@
             Executing command: `atmos terraform plan mock -s idontexist`

            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-Could not find the component 'mock' in the stack 'idontexist'. Check that all the context variables are correctly defined in the stack manifests. Are the component and stack names correct? Did you forget an import?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
             # Workflow Error

             workflow step execution failed

    --- FAIL: TestCLICommands/atmos_workflow_failure_with_stack (0.06s)
        cli_test.go:1162: Stderr diff mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_workflow_failure_with_stack.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,11 +1,5 @@
             Executing command: `atmos terraform plan idontexist`

            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-Could not find the component 'idontexist' in the stack 'prod'. Check that all the context variables are correctly defined in the stack manifests. Are the component and stack names correct? Did you forget an import?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
             # Workflow Error

             workflow step execution failed

    --- FAIL: TestCLICommands/atmos_workflow_failure_with_filepath (0.07s)
        cli_test.go:1162: Stderr diff mismatch for "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/snapshots/TestCLICommands_atmos_workflow_failure_with_filepath.stdout.golden":
            [38;5;160m--- expected[0m
            [38;5;42m+++ actual[0m
            @@ -1,11 +1,5 @@
             Executing command: `atmos terraform plan mock -s idontexist`

            [38;5;160m-# Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [0m
            [38;5;160m-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        [0m
            [38;5;160m-Could not find the component 'mock' in the stack 'idontexist'. Check that all the context variables are correctly defined in the stack manifests. Are the component and stack names correct? Did you forget an import?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  [0m
            [38;5;160m-[0m
            [38;5;160m-[0m
            [38;5;160m-[0m
             # Workflow Error

             workflow step execution failed

{
  "atmos_cli_config": {
    "base_path": "./",
    "components": {
      "terraform": {
        "base_path": "../../components/terraform",
        "apply_auto_approve": false,
        "append_user_agent": "Atmos/test (Cloud Posse; +https://atmos.tools)",
        "deploy_run_init": true,
        "init_run_reconfigure": true,
        "auto_generate_backend_file": false,
        "command": "",
        "shell": {
          "prompt": ""
        },
        "init": {
          "pass_vars": false
        },
        "plan": {
          "skip_planfile": false
        }
      },
      "helmfile": {
        "base_path": "",
        "use_eks": true,
        "kubeconfig_path": "",
        "helm_aws_profile_pattern": "",
        "cluster_name_pattern": "",
        "command": ""
      },
      "packer": {
        "base_path": "",
        "command": ""
      }
    },
    "stacks": {
      "base_path": "stacks",
      "included_paths": [
        "deploy/**/*"
      ],
      "excluded_paths": [
        "**/_defaults.yaml"
      ],
      "name_pattern": "",
      "name_template": "{{ .vars.stage }}"
    },
    "workflows": {
      "base_path": "",
      "list": {
        "format": "",
        "columns": null
      }
    }
  },
  "atmos_component": "component-1",
  "atmos_manifest": "deploy/nonprod",
  "atmos_stack": "nonprod",
  "atmos_stack_file": "deploy/nonprod",
  "backend": {},
  "backend_type": "",
  "cli_args": [
    "describe",
    "component"
  ],
  "command": "terraform",
  "component": "component-1",
  "component_info": {
    "component_path": "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1",
    "component_type": "terraform",
    "terraform_config": {
      "path": "/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1",
      "variables": {},
      "outputs": {},
      "required_providers": {},
      "managed_resources": {},
      "data_resources": {},
      "module_calls": {},
      "diagnostics": [
        {
          "severity": "error",
          "summary": "Failed to read directory",
          "detail": "Directory /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1 does not exist or cannot be read."
        }
      ]
    }
  },
  "component_type": "terraform",
  "deps": [
    "deploy/nonprod"
  ],
  "deps_all": [
    "deploy/nonprod"
  ],
  "env": {},
  "hooks": {},
  "imports": [],
  "inheritance": [],
  "metadata": {
    "type": "abstract"
  },
  "overrides": {},
  "providers": {
    "aws": {
      "assume_role": {
        "role_arn": "Base component IAM Role ARN"
      }
    },
    "context": {
      "delimiter": "-",
      "enabled": true,
      "property_order": [
        "product",
        "region",
        "environment",
        "name"
      ]
    }
  },
  "remote_state_backend": {},
  "remote_state_backend_type": "",
  "settings": {},
  "sources": {
    "backend": {},
    "env": {},
    "settings": {},
    "vars": {
      "bar": {
        "final_value": "component-1-bar",
        "name": "bar",
        "stack_dependencies": [
          {
            "dependency_type": "inline",
            "stack_file": "deploy/nonprod",
            "stack_file_section": "components.terraform.vars",
            "variable_value": "component-1-bar"
          }
        ]
      },
      "baz": {
        "final_value": "component-1-baz",
        "name": "baz",
        "stack_dependencies": [
          {
            "dependency_type": "inline",
            "stack_file": "deploy/nonprod",
            "stack_file_section": "components.terraform.vars",
            "variable_value": "component-1-baz"
          }
        ]
      },
      "foo": {
        "final_value": "component-1-foo",
        "name": "foo",
        "stack_dependencies": [
          {
            "dependency_type": "inline",
            "stack_file": "deploy/nonprod",
            "stack_file_section": "components.terraform.vars",
            "variable_value": "component-1-foo"
          }
        ]
      },
      "stage": {
        "final_value": "nonprod",
        "name": "stage",
        "stack_dependencies": [
          {
            "dependency_type": "inline",
            "stack_file": "deploy/nonprod",
            "stack_file_section": "vars",
            "variable_value": "nonprod"
          }
        ]
      }
    }
  },
  "stack": "nonprod",
  "tf_cli_vars": {},
  "vars": {
    "bar": "component-1-bar",
    "baz": "component-1-baz",
    "foo": "component-1-foo",
    "stage": "nonprod"
  },
  "workspace": "nonprod"
}
atmos_cli_config:
  base_path: ./
  components:
    terraform:
      base_path: ../../components/terraform
      apply_auto_approve: false
      append_user_agent: Atmos/test (Cloud Posse; +https://atmos.tools)
      deploy_run_init: true
      init_run_reconfigure: true
      auto_generate_backend_file: false
      command: ""
      shell:
        prompt: ""
      init:
        pass_vars: false
      plan:
        skip_planfile: false
    helmfile:
      base_path: ""
      use_eks: true
      kubeconfig_path: ""
      helm_aws_profile_pattern: ""
      cluster_name_pattern: ""
      command: ""
    packer:
      base_path: ""
      command: ""
  stacks:
    base_path: stacks
    included_paths:
      - deploy/**/*
    excluded_paths:
      - '**/_defaults.yaml'
    name_pattern: ""
    name_template: '{{ .vars.stage }}'
  workflows:
    base_path: ""
    list:
      format: ""
      columns: []
atmos_component: component-1
atmos_manifest: deploy/nonprod
atmos_stack: nonprod
atmos_stack_file: deploy/nonprod
backend: {}
backend_type: ""
cli_args:
  - describe
  - component
command: terraform
component: component-1
component_info:
  component_path: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1
  component_type: terraform
  terraform_config:
    path: /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1
    variables: {}
    outputs: {}
    requiredcore: []
    requiredproviders: {}
    providerconfigs: {}
    managedresources: {}
    dataresources: {}
    modulecalls: {}
    diagnostics:
      - severity: 69
        summary: Failed to read directory
        detail: Directory /Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/components/terraform/component-1 does not exist or cannot be read.
        pos: null
component_type: terraform
deps:
  - deploy/nonprod
deps_all:
  - deploy/nonprod
env: {}
hooks: {}
imports: []
inheritance: []
metadata:
  type: abstract
overrides: {}
providers:
  aws:
    assume_role:
      role_arn: Base component IAM Role ARN
  context:
    delimiter: '-'
    enabled: true
    property_order:
      - product
      - region
      - environment
      - name
remote_state_backend: {}
remote_state_backend_type: ""
settings: {}
sources:
  backend: {}
  env: {}
  settings: {}
  vars:
    bar:
      final_value: component-1-bar
      name: bar
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value: component-1-bar
    baz:
      final_value: component-1-baz
      name: baz
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value: component-1-baz
    foo:
      final_value: component-1-foo
      name: foo
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: components.terraform.vars
          variable_value: component-1-foo
    stage:
      final_value: nonprod
      name: stage
      stack_dependencies:
        - dependency_type: inline
          stack_file: deploy/nonprod
          stack_file_section: vars
          variable_value: nonprod
stack: nonprod
tf_cli_vars: {}
vars:
  bar: component-1-bar
  baz: component-1-baz
  foo: component-1-foo
  stage: nonprod
workspace: nonprod

2025/09/28 16:36:00 INFO No Validation Errors file=/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/scenarios/schemas-validation-positive/config.yaml schema=./manifest.json
2025/09/28 16:36:00 INFO No Validation Errors file=/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/scenarios/schemas-validation-positive/inline.yaml
  schema=
  │ {
  │   "type": "object",
  │   "properties": {
  │     "name": { "type": "string" },
  │     "age": { "type": "integer" }
  │   },
  │   "required": ["name"]
  │ }

2025/09/28 16:36:00 INFO No Validation Errors file=/Users/erik/Dev/cloudposse/tools/atmos/.conductor/import-context/tests/fixtures/scenarios/schemas-validation-positive/bower.yaml schema=https://json.schemastore.org/bower.json

FAIL
FAIL	github.com/cloudposse/atmos/tests	326.368s
ok  	github.com/cloudposse/atmos/tests/testhelpers	102.958s
FAIL
