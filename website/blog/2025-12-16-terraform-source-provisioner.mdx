---
slug: terraform-source-provisioner
title: "Just-in-Time Component Vendoring with source"
authors: [osterman]
tags: [feature]
---

Atmos now supports just-in-time (JIT) vendoring of Terraform components directly from stack configuration using the top-level `source` field. This enables you to declare component sources inline without requiring separate `component.yaml` files.

<!--truncate-->

## What Changed

We've added a new `atmos terraform source` command group that enables JIT vendoring based on `source` configuration in your stack manifests:

```yaml
components:
  terraform:
    vpc:
      source:
        uri: github.com/cloudposse/terraform-aws-components//modules/vpc
        version: 1.450.0
        included_paths:
          - "*.tf"
        excluded_paths:
          - "*.md"
          - "tests/**"
```

The new commands include:
- `atmos terraform source pull` - Vendor a component from source configuration (use `--force` to re-vendor)
- `atmos terraform source list` - List components with source configured
- `atmos terraform source describe` - View source configuration
- `atmos terraform source delete` - Remove vendored source directory

## Why This Matters

Previously, vendoring components required maintaining separate `component.yaml` files alongside your stack configuration. This created maintenance overhead and made it harder to:

1. **Version per environment** - Different environments often need different component versions
2. **Keep configuration colocated** - Source information was separated from component configuration
3. **Vendor on demand** - Components had to be pre-vendored before use

With `source`, you can now:

- **Declare sources inline** in your stack manifests
- **Override versions per environment** using stack inheritance
- **Vendor just-in-time** when you need the component
- **Filter files** with `included_paths` and `excluded_paths`

## No Vendored Components Committed to Git

With source-based versioning, you no longer need to commit vendored component code to your Git repository if that's not adding value for your workflow. Components are downloaded just-in-time during execution instead of being pre-vendored and checked in. This means:

**Benefits:**
- **Smaller repositories** - No vendored Terraform code bloating your git history
- **Faster clones** - Particularly helpful for large component libraries
- **Simplified PRs** - Version changes are single-line config updates, not large diffs

**Tradeoffs:**
- **No local immutable copy** - Components aren't in your repo, so you lose the audit trail in Git
- **No pre-deploy diff review** - Can't review component code changes before deployment
- **AI coding assistants lack context** - Tools like Claude Code, Cursor, and GitHub Copilot work significantly better with vendored codeâ€”they have full context of your components for navigation, understanding dependencies, and accurate suggestions
- **Network dependency** - Requires network access during execution

For teams that value having vendored code committed for audit trails, code review, AI-assisted development, or offline deployments, traditional [vendoring](/vendor) remains the right choice. Source-based versioning is ideal when the operational overhead of vendoring outweighs its benefits.

## How to Use It

### Basic Usage

Add `source` to your component configuration:

```yaml
# stacks/dev.yaml
components:
  terraform:
    vpc:
      source:
        uri: github.com/cloudposse/terraform-aws-components//modules/vpc
        version: 1.450.0
      vars:
        cidr_block: "10.0.0.0/16"
```

Then vendor the component:

```shell
atmos terraform source pull vpc --stack dev
```

### Version Per Environment

Use stack inheritance to set different versions per environment:

```yaml
# stacks/catalog/vpc/defaults.yaml
components:
  terraform:
    vpc/defaults:
      source:
        uri: github.com/cloudposse/terraform-aws-components//modules/vpc
        version: 1.450.0

# stacks/dev.yaml - use latest
components:
  terraform:
    vpc:
      metadata:
        inherits: [vpc/defaults]
      source:
        version: 1.451.0  # Override for dev

# stacks/prod.yaml - pin to stable
components:
  terraform:
    vpc:
      metadata:
        inherits: [vpc/defaults]
      # Uses inherited version 1.450.0
```

### Supported Source Types

The source provisioner uses go-getter and supports:
- Git repositories (GitHub, GitLab, Bitbucket)
- S3 buckets
- GCS buckets
- HTTP/HTTPS URLs
- OCI registries

## Get Involved

We'd love to hear your feedback on this feature! Please [open an issue](https://github.com/cloudposse/atmos/issues) if you have questions or suggestions.

For more details, see the [terraform source documentation](/cli/commands/terraform/terraform-source) and the [Source-Based Version Pinning](/design-patterns/version-management/source-based-versioning) design pattern.
