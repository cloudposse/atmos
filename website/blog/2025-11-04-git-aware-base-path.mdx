---
slug: git-aware-base-path
title: "Git-Aware Base Path Configuration"
authors: [osterman]
tags: [atmos, cli, git, configuration]
date: 2025-11-04
---

Atmos 1.198.0 changes the default `base_path` to resolve to your git repository root. This allows running Atmos commands from any subdirectory within your repository.

<!--truncate-->

## What Changed

Previously, Atmos looked for `atmos.yaml` starting from the current working directory. If you were in a subdirectory, it would fail to find the configuration file.

```bash
# Repository structure
/infra-repo/
├── atmos.yaml
├── components/
│   └── terraform/
│       └── vpc/
└── stacks/

# This failed in versions prior to 1.198.0
cd /infra-repo/components/terraform/vpc
atmos terraform plan vpc --stack prod
# Error: atmos.yaml CLI config file was not found
```

Starting with 1.198.0, the default embedded configuration includes `base_path: "!repo-root"`, which resolves to your git repository root.

## Behavior

```bash
# Now works from any subdirectory
cd /infra-repo/components/terraform/vpc
atmos terraform plan vpc --stack prod
# Finds atmos.yaml at /infra-repo/atmos.yaml
```

The `!repo-root` YAML function resolves to the output of `git rev-parse --show-toplevel`. If not in a git repository, it falls back to the current directory.

## YAML Function Support

The `--base-path` flag and `ATMOS_BASE_PATH` environment variable now support YAML functions:

```bash
# Using CLI flag
atmos --base-path='!repo-root' terraform plan vpc --stack prod

# Using environment variable
export ATMOS_BASE_PATH='!repo-root'
atmos terraform plan vpc --stack prod

# Using !env function
export INFRA_ROOT=/path/to/infra
atmos --base-path='!env INFRA_ROOT' terraform plan vpc --stack prod
```

## Restoring Previous Behavior

If you need the pre-1.198.0 behavior (current directory as base path), add this to your `atmos.yaml`:

```yaml
base_path: "."
```

This sets the base path to the current working directory, matching the behavior of Atmos versions prior to 1.198.0.

## Migration

Most users won't need to change anything. The new default works for repositories where:
- `atmos.yaml` is at the repository root
- You want to run commands from any subdirectory

If your setup relies on `atmos.yaml` being in the current directory (not the repo root), explicitly set `base_path: "."` in your configuration.

## Technical Details

**Configuration precedence** (highest to lowest):
1. `--base-path` CLI flag
2. `ATMOS_BASE_PATH` environment variable
3. `base_path` in `atmos.yaml`
4. Embedded default: `base_path: "!repo-root"`

**Git root detection:**
- Uses `git rev-parse --show-toplevel`
- Falls back to current directory if not in a git repository
- Can be overridden with `TEST_GIT_ROOT` environment variable (for testing)

## Breaking Change

This is a breaking change if:
- Your `atmos.yaml` is not at your git repository root
- You rely on the current directory as the base path
- Your scripts assume Atmos must be run from a specific directory

**Fix:** Add `base_path: "."` to your `atmos.yaml` to restore the previous behavior.
