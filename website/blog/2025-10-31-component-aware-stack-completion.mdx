---
slug: component-aware-stack-completion
title: Component-Aware Stack Tab Completion
authors: [atmos]
tags: [atmos, enhancement, dx, shell-completion]
date: 2025-10-31
---

Tab completion for the `--stack` flag is now context-aware, filtering suggestions based on the component you specify.

<!--truncate-->

## What Changed

When running Terraform commands like `atmos terraform plan <component> --stack <TAB>`, the shell completion now intelligently filters stack suggestions to only show stacks that contain the specified component.

**Before:**
```bash
$ atmos terraform plan vpc --stack <TAB>
dev  prod  staging  test-1  test-2  # All stacks shown
```

**After:**
```bash
$ atmos terraform plan vpc --stack <TAB>
dev  prod  # Only stacks containing the vpc component
```

## Why This Matters

This enhancement improves the developer experience by:

- **Reducing cognitive load** - You only see relevant options
- **Preventing errors** - Less chance of selecting an invalid stack/component combination
- **Faster navigation** - Fewer completions to scroll through
- **Better discoverability** - Quickly see which stacks include a particular component

## How It Works

The completion system leverages Atmos's existing `list stacks --component <name>` functionality. When you provide a component argument, the `--stack` flag completion automatically filters the stack list based on which stacks define that component.

If no component is specified, all stacks are shown (preserving the original behavior).

## Example

Given this stack configuration:

```yaml
# stacks/dev.yaml
components:
  terraform:
    vpc:
      vars: {...}
    myapp:
      vars: {...}

# stacks/prod.yaml
components:
  terraform:
    vpc:
      vars: {...}
```

Tab completion will now show:
- `atmos terraform plan vpc --stack <TAB>` → `dev` and `prod`
- `atmos terraform plan myapp --stack <TAB>` → `dev` only

This works across all Terraform commands: `plan`, `apply`, `deploy`, `destroy`, and more.
