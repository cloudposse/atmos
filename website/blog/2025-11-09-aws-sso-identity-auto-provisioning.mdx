---
title: Zero-Configuration AWS SSO Identity Management
description: Automatically provision AWS SSO permission sets as Atmos identities - authenticate once, use any role
authors: [osterman]
tags: [feature, aws, sso, authentication, zero-config]
---

Atmos now automatically provisions AWS SSO permission sets as identities when you authenticate. Log in once, and all your available roles are instantly ready to use—no manual configuration required.

<!--truncate-->

## The Zero-Configuration Principle

One of Atmos's core design principles is **zero-configuration**: the tool should work intelligently out of the box, reducing friction and setup time. With AWS SSO identity auto-provisioning, we're bringing this principle to authentication.

Previously, if you had access to 50 AWS accounts with multiple permission sets each, you'd need to manually configure hundreds of identity entries in your `atmos.yaml`. This was tedious, error-prone, and a barrier to adoption.

Now, you authenticate once with `atmos auth login`, and Atmos automatically discovers and provisions all available permission sets as identities. You can immediately use any role without touching configuration files.

## Why This Matters

### Time to First Auth: <2 Minutes

The metric we care about most is **time to first auth**—the duration from cloning a repository to successfully authenticating and deploying infrastructure.

**Before auto-provisioning:**
- Clone repository
- Read documentation to understand identity configuration
- Query AWS SSO for available accounts and roles
- Manually write 50+ identity entries in `atmos.yaml`
- Test authentication with each identity
- **Total time: 10+ minutes** (often much longer)

**After auto-provisioning:**
```yaml
# atmos.yaml
auth:
  providers:
    sso-prod:
      kind: aws/iam-identity-center
      start_url: https://my-org.awsapps.com/start
      region: us-east-1
      auto_provision_identities: true  # One line to enable
```

```bash
atmos auth login sso-prod
# ✓ Provisioned 47 identities across 12 accounts (2.3s)

atmos terraform plan --identity production/AdministratorAccess
# Works immediately - no additional configuration
```

**Total time: <2 minutes**

### Developer Experience

Auto-provisioning removes common friction points:

1. **No manual configuration**: Identities are discovered automatically from AWS SSO
2. **Always up-to-date**: New accounts and roles appear automatically after re-authentication
3. **Works across teams**: Same configuration works for all team members regardless of their assigned permission sets
4. **Fail-safe**: Provisioning failures don't block authentication—worst case, you fall back to manual configuration

## How It Works

### High-Level Architecture

Auto-provisioning follows a two-phase design:

**Phase 1: Authentication & Provisioning**
1. User authenticates: `atmos auth login sso-prod`
2. Provider with `auto_provision_identities: true` queries AWS SSO APIs
3. `ListAccounts` discovers all accessible AWS accounts
4. `ListAccountRoles` discovers permission sets for each account
5. Identities are written to `~/.cache/atmos/aws/sso-prod/provisioned-identities.yaml`

**Phase 2: Config Loading**
1. User runs any Atmos command: `atmos terraform plan`
2. Config loader automatically imports provisioned identity files
3. Provisioned imports are loaded FIRST (manual config takes precedence)
4. All identities (manual + provisioned) are available

### Dynamic Import Injection

The key innovation is **dynamic import injection** during config loading. Provisioned identities are stored as standard Atmos config files in the XDG cache directory (`~/.cache`), then automatically imported before your manual configuration.

This approach has several advantages:

- **Separation of concerns**: Provisioned identities don't pollute your version-controlled config
- **Manual override**: Your `atmos.yaml` imports process after provisioned imports, allowing you to override or customize any identity
- **Standard format**: Provisioned files use the same YAML structure as manual config—you can view, edit, or copy them as needed
- **Cache invalidation**: Delete the cache directory to force re-provisioning

### Provider-Specific Implementation

Not all providers support auto-provisioning. It's an **optional capability** that providers can implement via the `Provisioner` interface:

```go
type Provisioner interface {
    ProvisionIdentities(ctx context.Context, creds ICredentials) (*Result, error)
}
```

Currently supported providers:
- **AWS IAM Identity Center (SSO)**: Uses `ListAccounts` and `ListAccountRoles` APIs

Planned support:
- Okta (via SCIM or Okta API)
- Azure AD (via Microsoft Graph)
- Google Workspace (via Directory API)

The provisioner architecture is extensible—new providers can be added without changing the core authentication system.

## Configuration

### Enable Auto-Provisioning

Add `auto_provision_identities: true` to your AWS SSO provider:

```yaml
# atmos.yaml
auth:
  providers:
    sso-prod:
      kind: aws/iam-identity-center
      start_url: https://my-org.awsapps.com/start
      region: us-east-1
      auto_provision_identities: true  # Enable auto-provisioning
```

### Viewing Provisioned Identities

Use `atmos auth list` to see all identities, including provisioned ones:

```bash
atmos auth list
# Authentication Configuration
# └──sso-prod (aws/iam-identity-center)
#    └──Identities
#       ├──● production/AdministratorAccess (sso-prod) 11h58m
#       ├──● production/PowerUserAccess (sso-prod) 11h58m
#       ├──● staging/AdministratorAccess (sso-prod) 11h58m
#       └──● dev/ReadOnly (sso-prod) 11h58m
```

Provisioned identities appear in the tree view alongside manually configured identities. There's no visual distinction—they're treated as first-class identities.

### Manual Override

Provisioned identities can be overridden in your `atmos.yaml`:

```yaml
# atmos.yaml
auth:
  providers:
    sso-prod:
      kind: aws/iam-identity-center
      start_url: https://my-org.awsapps.com/start
      region: us-east-1
      auto_provision_identities: true

  identities:
    # Override provisioned identity with custom session duration
    production/AdministratorAccess:
      session:
        duration: 12h  # Extend from default 1h
```

Manual configuration takes precedence over provisioned configuration due to import order.

### Cache Location

Provisioned identities are stored in the XDG cache directory:

```
~/.cache/atmos/aws/
└── sso-prod/
    └── provisioned-identities.yaml
```

You can inspect this file to see exactly what was provisioned:

```bash
cat ~/.cache/atmos/aws/sso-prod/provisioned-identities.yaml
```

To force re-provisioning, delete the cache file and re-authenticate:

```bash
rm -rf ~/.cache/atmos/aws/sso-prod
atmos auth login sso-prod
```

## Use Cases

### 1. Multi-Account AWS Deployments

Organizations with many AWS accounts benefit immediately:

```bash
# Before: Manually configure 50+ identities
# After: One login, 50+ identities available

atmos auth login sso-prod
atmos terraform plan --identity prod-us-east-1/PowerUser
atmos terraform plan --identity prod-eu-west-1/Administrator
atmos terraform plan --identity staging-us-west-2/ReadOnly
# All work without additional configuration
```

### 2. Team Onboarding

New team members can authenticate and deploy in minutes:

```bash
git clone https://github.com/acme/infrastructure
cd infrastructure
atmos auth login sso-prod
atmos terraform plan --identity production/AdministratorAccess
# Ready to deploy
```

### 3. CI/CD Pipelines

Pipelines can use OIDC authentication without hardcoding identity names:

```yaml
# GitHub Actions
- name: Deploy to Production
  run: |
    atmos auth login sso-prod
    atmos terraform apply --identity production/AdministratorAccess
```

The identity exists regardless of which engineer's permission set structure the pipeline mirrors.

## Implementation Details

### Non-Fatal Provisioning

Provisioning is designed to be **non-fatal**. If provisioning fails for any reason:

1. The failure is logged as a warning
2. Authentication proceeds successfully
3. You fall back to manually configured identities

This ensures that auto-provisioning never blocks your workflow—worst case, you're in the same position as before the feature existed.

### Identity Naming Convention

Provisioned identities use the naming convention:

```
{account-name}/{permission-set-name}
```

Examples:
- `production/AdministratorAccess`
- `staging/PowerUserAccess`
- `dev-us-east-1/ReadOnly`

This convention ensures unique names and makes it easy to understand which account and role each identity represents.

### Provisioning Metadata

Each provisioned identity file includes metadata:

```yaml
auth:
  identities:
    production/AdministratorAccess:
      provider: sso-prod
      principal:
        name: AdministratorAccess
        account:
          name: production
          id: "123456789012"

  _metadata:
    provisioned_at: "2025-11-09T12:00:00Z"
    source: aws-sso
    provider: sso-prod
    counts:
      accounts: 12
      roles: 47
      identities: 47
```

This metadata is useful for debugging and understanding what was provisioned.

## Future Enhancements

We're planning several enhancements to auto-provisioning:

1. **Okta Support**: Auto-provision identities from Okta applications and roles
2. **Azure AD Support**: Discover Azure subscriptions and roles via Microsoft Graph
3. **Filtering**: Configure which accounts or roles to provision (e.g., only production accounts)
4. **Custom Naming**: Override default naming convention for provisioned identities
5. **Refresh Command**: `atmos auth refresh` to re-provision without re-authenticating

## Migration Guide

### Existing Manual Configurations

If you already have manual identity configurations, auto-provisioning works alongside them:

1. Enable `auto_provision_identities: true`
2. Authenticate: `atmos auth login`
3. Provisioned identities are added without affecting manual ones
4. Gradually remove manual configurations if desired

### Opt-Out

Auto-provisioning is opt-in via the `auto_provision_identities` flag. To disable:

```yaml
auth:
  providers:
    sso-prod:
      auto_provision_identities: false  # Explicit disable
      # Or simply omit the flag (defaults to false)
```

## Get Started

Auto-provisioning is available in Atmos v2.x. To enable it:

1. Update your `atmos.yaml`:
   ```yaml
   auth:
     providers:
       sso-prod:
         kind: aws/iam-identity-center
         start_url: https://your-org.awsapps.com/start
         region: us-east-1
         auto_provision_identities: true
   ```

2. Authenticate:
   ```bash
   atmos auth login sso-prod
   ```

3. Use any available role:
   ```bash
   atmos terraform plan --identity production/AdministratorAccess
   ```

For detailed configuration options, see the [AWS SSO Provider Documentation](/cli/commands/auth/providers/aws-sso).

## Feedback

We'd love to hear how auto-provisioning works for your use case. Share your experience in [GitHub Discussions](https://github.com/cloudposse/atmos/discussions) or report issues in [GitHub Issues](https://github.com/cloudposse/atmos/issues).
