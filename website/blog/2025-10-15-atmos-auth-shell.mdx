---
slug: introducing-atmos-auth-shell
title: "Introducing atmos auth shell: Seamlessly Authenticate and Execute"
authors: [atmos]
tags: [atmos, authentication, shell, aws, cloud]
---

We're excited to announce a new command in Atmos that streamlines your cloud authentication workflow: `atmos auth shell`. This powerful new feature launches an interactive shell session with your cloud credentials pre-configured, eliminating the need to repeatedly authenticate or export environment variables.

<!-- truncate -->

## The Problem

When working with cloud infrastructure, you often need to:

1. Authenticate with your cloud provider (AWS, Azure, GCP, etc.)
2. Export credentials as environment variables
3. Run multiple commands using those credentials
4. Re-authenticate when credentials expire

This workflow becomes tedious when switching between different identities, roles, or accounts throughout the day. You might find yourself running commands like:

```shell
# Traditional workflow
eval $(atmos auth env --identity prod-admin --format bash)
aws s3 ls
aws ecs list-clusters
kubectl get pods
# ... many more commands ...
```

Every time you need to switch identities or your session expires, you have to repeat the authentication and export steps.

## The Solution: `atmos auth shell`

The new `atmos auth shell` command solves this by launching an interactive shell with your authentication environment pre-configured. Simply run:

```shell
atmos auth shell --identity prod-admin
```

And you're immediately in a shell session with all your cloud credentials ready to use. The session exposes environment variables like `ATMOS_IDENTITY` (the active identity name) and `ATMOS_SHLVL` (shell nesting level) that you can run as many commands as you need without worrying about authentication.

:::tip Customize Your Prompt
Want to see which identity is active in your prompt? You can customize your shell prompt by adding `ATMOS_IDENTITY` or `ATMOS_SHLVL` to your `PS1` (bash) or equivalent prompt variable in your shell configuration file (e.g., `.bashrc`, `.zshrc`).

Example for bash:
```bash
export PS1='[\u@\h \W${ATMOS_IDENTITY:+ ($ATMOS_IDENTITY)}]\$ '
```
:::

## Why This Matters: Isolation and Safety

The traditional approach to managing cloud credentialsâ€”storing multiple profiles in `~/.aws/credentials` or exporting variables in your main shellâ€”is fundamentally unsafe. When all credentials are accessible simultaneously in a single shell session, it's dangerously easy to accidentally run commands against the wrong environment:

- You think you're in `dev`, but you're actually authenticated to `prod`
- You modify a staging database when you meant to update a development one
- You deploy infrastructure changes to the wrong AWS account

**`atmos auth shell` solves this through isolation**. Each shell session is scoped to exactly one identity with one set of credentials. When you run:

```shell
atmos auth shell --identity prod-admin
```

You get a dedicated shell where **only** those production credentials are available. When you exit, your parent shell's environment remains completely unchangedâ€”no credential pollution, no confusion about which environment you're operating in.

### The Power of Multiple Concurrent Sessions

This isolation enables a powerful workflow: **run multiple authenticated shells simultaneously, each scoped to a different identity**:

```shell
# Terminal 1: Production operations
atmos auth shell --identity prod-admin

# Terminal 2: Staging testing
atmos auth shell --identity staging-dev

# Terminal 3: Development work
atmos auth shell --identity dev-sandbox
```

Each terminal operates in complete isolation. You can't accidentally run a production command in your development shell, and vice versa. Your credentials are **ephemeral and session-scoped**â€”when you close a terminal, those credentials disappear. No lingering environment variables, no shared credential files with overly broad access.

The command supports multiple identities, custom shells (`--shell`), custom arguments (`--`), shell nesting tracking (`ATMOS_SHLVL`), and works cross-platform.

## Real-World Use Cases

### Safe Production Operations

```shell
atmos auth shell --identity prod-admin
# Now in authenticated shell, scoped ONLY to production
aws s3 sync ./assets s3://prod-bucket/
aws ecs update-service --cluster prod --service api --force-new-deployment
aws rds describe-db-instances --region us-east-1
exit
# Credentials goneâ€”your main shell is still clean
```

When you exit, those production credentials are gone. You can't accidentally run a production command after switching contexts.

### Debugging Cloud Resources

```shell
atmos auth shell --identity dev-debug
# Isolated shell with ONLY dev credentials
aws logs tail /aws/lambda/my-function --follow
kubectl get pods -n development
aws dynamodb scan --table-name dev-users
exit
```

### Long-Running Operations with Multiple Steps

```shell
atmos auth shell --identity migration-role
# Run multiple migration steps without re-authenticating
./migrate-database.sh
./update-dns-records.sh
aws s3 sync ./backups s3://migration-bucket/
./verify-migration.sh
exit
```

### Multiple Concurrent Environments

Open multiple terminals, each with different credentials:

```shell
# Terminal 1: Monitoring production
atmos auth shell --identity prod-readonly
watch aws cloudwatch get-metric-statistics ...

# Terminal 2: Testing in staging
atmos auth shell --identity staging-admin
terraform apply -target=module.test_feature

# Terminal 3: Development work
atmos auth shell --identity dev-sandbox
aws s3 cp ./test-data s3://dev-uploads/
```

Each terminal has **exactly one set of credentials**. No confusion, no accidents.

## How It Works

Under the hood, `atmos auth shell`:

1. **Authenticates** with your configured identity provider
2. **Retrieves** temporary credentials from your cloud provider
3. **Writes** credentials to Atmos-managed configuration files
4. **Sets** environment variables pointing to these config files (e.g., `AWS_SHARED_CREDENTIALS_FILE`, `AWS_CONFIG_FILE`, `AWS_PROFILE`)
5. **Sets** `ATMOS_IDENTITY` to track which identity is active
6. **Launches** your preferred shell with all environment variables configured
7. **Propagates** the shell's exit code back to Atmos when you exit

## Environment Variables

When you're in an `atmos auth shell` session, you'll have access to:

- **`ATMOS_IDENTITY`**: The name of the active identity
- **`ATMOS_SHLVL`**: Shell nesting level (increments for nested shells)
- **AWS configuration paths** (for AWS identities):
  - `AWS_SHARED_CREDENTIALS_FILE`: Path to Atmos-managed credentials file
  - `AWS_CONFIG_FILE`: Path to Atmos-managed config file
  - `AWS_PROFILE`: Profile name corresponding to your identity

These environment variables work seamlessly with any tool that uses the AWS SDK, such as Terraform, the AWS CLI, kubectl with AWS authentication, and more. Credentials are never exposed directly in environment variablesâ€”only secure file paths are set.

## Getting Started

The `atmos auth shell` command is available now in the latest version of Atmos. To start using it:

1. **Configure your identity** in `atmos.yaml`:

```yaml
auth:
  providers:
    - type: aws
      name: aws-sso
      config:
        sso_start_url: https://your-org.awsapps.com/start
        sso_region: us-east-1

  identities:
    - name: dev-user
      provider: aws-sso
      config:
        account_id: "123456789012"
        role_name: DeveloperRole

    - name: prod-admin
      provider: aws-sso
      config:
        account_id: "987654321098"
        role_name: AdminRole
```

2. **Launch your authenticated shell**:

```shell
atmos auth shell --identity dev-user
```

3. **Start working** with your cloud resources!

## Learn More

- [PR #1640](https://github.com/cloudposse/atmos/pull/1640)

## What's Next?

We're continuously improving Atmos authentication capabilities. Future enhancements may include:

- Session duration customization
- Automatic credential refresh
- Multi-cloud authentication in a single shell
- Integration with external secret managers

Have feedback or suggestions? [Open an issue](https://github.com/cloudposse/atmos/issues) or join the discussion in our community!

---

Happy authenticating! ðŸš€
