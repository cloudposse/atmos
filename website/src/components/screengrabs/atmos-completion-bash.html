# bash completion for atmos                                -*- shell-script -*-

__atmos_debug()
{
    if [[ -n ${BASH_COMP_DEBUG_FILE:-} ]]; then
        echo &quot;$*&quot; &gt;&gt; &quot;${BASH_COMP_DEBUG_FILE}&quot;
    fi
}

# Homebrew on Macs have version 1.3 of bash-completion which doesn't include
# _init_completion. This is a very minimal version of that function.
__atmos_init_completion()
{
    COMPREPLY=()
    _get_comp_words_by_ref &quot;$@&quot; cur prev words cword
}

__atmos_index_of_word()
{
    local w word=$1
    shift
    index=0
    for w in &quot;$@&quot;; do
        [[ $w = &quot;$word&quot; ]] &amp;&amp; return
        index=$((index+1))
    done
    index=-1
}

__atmos_contains_word()
{
    local w word=$1; shift
    for w in &quot;$@&quot;; do
        [[ $w = &quot;$word&quot; ]] &amp;&amp; return
    done
    return 1
}

__atmos_handle_go_custom_completion()
{
    __atmos_debug &quot;${FUNCNAME[0]}: cur is ${cur}, words[*] is ${words[*]}, #words[@] is ${#words[@]}&quot;

    local shellCompDirectiveError=1
    local shellCompDirectiveNoSpace=2
    local shellCompDirectiveNoFileComp=4
    local shellCompDirectiveFilterFileExt=8
    local shellCompDirectiveFilterDirs=16

    local out requestComp lastParam lastChar comp directive args

    # Prepare the command to request completions for the program.
    # Calling ${words[0]} instead of directly atmos allows handling aliases
    args=(&quot;${words[@]:1}&quot;)
    # Disable ActiveHelp which is not supported for bash completion v1
    requestComp=&quot;ATMOS_ACTIVE_HELP=0 ${words[0]} __completeNoDesc ${args[*]}&quot;

    lastParam=${words[$((${#words[@]}-1))]}
    lastChar=${lastParam:$((${#lastParam}-1)):1}
    __atmos_debug &quot;${FUNCNAME[0]}: lastParam ${lastParam}, lastChar ${lastChar}&quot;

    if [ -z &quot;${cur}&quot; ] &amp;&amp; [ &quot;${lastChar}&quot; != &quot;=&quot; ]; then
        # If the last parameter is complete (there is a space following it)
        # We add an extra empty parameter so we can indicate this to the go method.
        __atmos_debug &quot;${FUNCNAME[0]}: Adding extra empty parameter&quot;
        requestComp=&quot;${requestComp} \&quot;\&quot;&quot;
    fi

    __atmos_debug &quot;${FUNCNAME[0]}: calling ${requestComp}&quot;
    # Use eval to handle any environment variables and such
    out=$(eval &quot;${requestComp}&quot; 2&gt;/dev/null)

    # Extract the directive integer at the very end of the output following a colon (:)
    directive=${out##*:}
    # Remove the directive
    out=${out%:*}
    if [ &quot;${directive}&quot; = &quot;${out}&quot; ]; then
        # There is not directive specified
        directive=0
    fi
    __atmos_debug &quot;${FUNCNAME[0]}: the completion directive is: ${directive}&quot;
    __atmos_debug &quot;${FUNCNAME[0]}: the completions are: ${out}&quot;

    if [ $((directive &amp; shellCompDirectiveError)) -ne 0 ]; then
        # Error code.  No completion.
        __atmos_debug &quot;${FUNCNAME[0]}: received error from custom completion go code&quot;
        return
    else
        if [ $((directive &amp; shellCompDirectiveNoSpace)) -ne 0 ]; then
            if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
                __atmos_debug &quot;${FUNCNAME[0]}: activating no space&quot;
                compopt -o nospace
            fi
        fi
        if [ $((directive &amp; shellCompDirectiveNoFileComp)) -ne 0 ]; then
            if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
                __atmos_debug &quot;${FUNCNAME[0]}: activating no file completion&quot;
                compopt +o default
            fi
        fi
    fi

    if [ $((directive &amp; shellCompDirectiveFilterFileExt)) -ne 0 ]; then
        # File extension filtering
        local fullFilter filter filteringCmd
        # Do not use quotes around the $out variable or else newline
        # characters will be kept.
        for filter in ${out}; do
            fullFilter+=&quot;$filter|&quot;
        done

        filteringCmd=&quot;_filedir $fullFilter&quot;
        __atmos_debug &quot;File filtering command: $filteringCmd&quot;
        $filteringCmd
    elif [ $((directive &amp; shellCompDirectiveFilterDirs)) -ne 0 ]; then
        # File completion for directories only
        local subdir
        # Use printf to strip any trailing newline
        subdir=$(printf &quot;%s&quot; &quot;${out}&quot;)
        if [ -n &quot;$subdir&quot; ]; then
            __atmos_debug &quot;Listing directories in $subdir&quot;
            __atmos_handle_subdirs_in_dir_flag &quot;$subdir&quot;
        else
            __atmos_debug &quot;Listing directories in .&quot;
            _filedir -d
        fi
    else
        while IFS='' read -r comp; do
            COMPREPLY+=(&quot;$comp&quot;)
        done &lt; &lt;(compgen -W &quot;${out}&quot; -- &quot;$cur&quot;)
    fi
}

__atmos_handle_reply()
{
    __atmos_debug &quot;${FUNCNAME[0]}&quot;
    local comp
    case $cur in
        -*)
            if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
                compopt -o nospace
            fi
            local allflags
            if [ ${#must_have_one_flag[@]} -ne 0 ]; then
                allflags=(&quot;${must_have_one_flag[@]}&quot;)
            else
                allflags=(&quot;${flags[*]} ${two_word_flags[*]}&quot;)
            fi
            while IFS='' read -r comp; do
                COMPREPLY+=(&quot;$comp&quot;)
            done &lt; &lt;(compgen -W &quot;${allflags[*]}&quot; -- &quot;$cur&quot;)
            if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
                [[ &quot;${COMPREPLY[0]}&quot; == *= ]] || compopt +o nospace
            fi

            # complete after --flag=abc
            if [[ $cur == *=* ]]; then
                if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
                    compopt +o nospace
                fi

                local index flag
                flag=&quot;${cur%=*}&quot;
                __atmos_index_of_word &quot;${flag}&quot; &quot;${flags_with_completion[@]}&quot;
                COMPREPLY=()
                if [[ ${index} -ge 0 ]]; then
                    PREFIX=&quot;&quot;
                    cur=&quot;${cur#*=}&quot;
                    ${flags_completion[${index}]}
                    if [ -n &quot;${ZSH_VERSION:-}&quot; ]; then
                        # zsh completion needs --flag= prefix
                        eval &quot;COMPREPLY=( \&quot;\${COMPREPLY[@]/#/${flag}=}\&quot; )&quot;
                    fi
                fi
            fi

            if [[ -z &quot;${flag_parsing_disabled}&quot; ]]; then
                # If flag parsing is enabled, we have completed the flags and can return.
                # If flag parsing is disabled, we may not know all (or any) of the flags, so we fallthrough
                # to possibly call handle_go_custom_completion.
                return 0;
            fi
            ;;
    esac

    # check if we are handling a flag with special work handling
    local index
    __atmos_index_of_word &quot;${prev}&quot; &quot;${flags_with_completion[@]}&quot;
    if [[ ${index} -ge 0 ]]; then
        ${flags_completion[${index}]}
        return
    fi

    # we are parsing a flag and don't have a special handler, no completion
    if [[ ${cur} != &quot;${words[cword]}&quot; ]]; then
        return
    fi

    local completions
    completions=(&quot;${commands[@]}&quot;)
    if [[ ${#must_have_one_noun[@]} -ne 0 ]]; then
        completions+=(&quot;${must_have_one_noun[@]}&quot;)
    elif [[ -n &quot;${has_completion_function}&quot; ]]; then
        # if a go completion function is provided, defer to that function
        __atmos_handle_go_custom_completion
    fi
    if [[ ${#must_have_one_flag[@]} -ne 0 ]]; then
        completions+=(&quot;${must_have_one_flag[@]}&quot;)
    fi
    while IFS='' read -r comp; do
        COMPREPLY+=(&quot;$comp&quot;)
    done &lt; &lt;(compgen -W &quot;${completions[*]}&quot; -- &quot;$cur&quot;)

    if [[ ${#COMPREPLY[@]} -eq 0 &amp;&amp; ${#noun_aliases[@]} -gt 0 &amp;&amp; ${#must_have_one_noun[@]} -ne 0 ]]; then
        while IFS='' read -r comp; do
            COMPREPLY+=(&quot;$comp&quot;)
        done &lt; &lt;(compgen -W &quot;${noun_aliases[*]}&quot; -- &quot;$cur&quot;)
    fi

    if [[ ${#COMPREPLY[@]} -eq 0 ]]; then
        if declare -F __atmos_custom_func &gt;/dev/null; then
            # try command name qualified custom func
            __atmos_custom_func
        else
            # otherwise fall back to unqualified for compatibility
            declare -F __custom_func &gt;/dev/null &amp;&amp; __custom_func
        fi
    fi

    # available in bash-completion &gt;= 2, not always present on macOS
    if declare -F __ltrim_colon_completions &gt;/dev/null; then
        __ltrim_colon_completions &quot;$cur&quot;
    fi

    # If there is only 1 completion and it is a flag with an = it will be completed
    # but we don't want a space after the =
    if [[ &quot;${#COMPREPLY[@]}&quot; -eq &quot;1&quot; ]] &amp;&amp; [[ $(type -t compopt) = &quot;builtin&quot; ]] &amp;&amp; [[ &quot;${COMPREPLY[0]}&quot; == --*= ]]; then
       compopt -o nospace
    fi
}

# The arguments should be in the form &quot;ext1|ext2|extn&quot;
__atmos_handle_filename_extension_flag()
{
    local ext=&quot;$1&quot;
    _filedir &quot;@(${ext})&quot;
}

__atmos_handle_subdirs_in_dir_flag()
{
    local dir=&quot;$1&quot;
    pushd &quot;${dir}&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; _filedir -d &amp;&amp; popd &gt;/dev/null 2&gt;&amp;1 || return
}

__atmos_handle_flag()
{
    __atmos_debug &quot;${FUNCNAME[0]}: c is $c words[c] is ${words[c]}&quot;

    # if a command required a flag, and we found it, unset must_have_one_flag()
    local flagname=${words[c]}
    local flagvalue=&quot;&quot;
    # if the word contained an =
    if [[ ${words[c]} == *&quot;=&quot;* ]]; then
        flagvalue=${flagname#*=} # take in as flagvalue after the =
        flagname=${flagname%=*} # strip everything after the =
        flagname=&quot;${flagname}=&quot; # but put the = back
    fi
    __atmos_debug &quot;${FUNCNAME[0]}: looking for ${flagname}&quot;
    if __atmos_contains_word &quot;${flagname}&quot; &quot;${must_have_one_flag[@]}&quot;; then
        must_have_one_flag=()
    fi

    # if you set a flag which only applies to this command, don't show subcommands
    if __atmos_contains_word &quot;${flagname}&quot; &quot;${local_nonpersistent_flags[@]}&quot;; then
      commands=()
    fi

    # keep flag value with flagname as flaghash
    # flaghash variable is an associative array which is only supported in bash &gt; 3.
    if [[ -z &quot;${BASH_VERSION:-}&quot; || &quot;${BASH_VERSINFO[0]:-}&quot; -gt 3 ]]; then
        if [ -n &quot;${flagvalue}&quot; ] ; then
            flaghash[${flagname}]=${flagvalue}
        elif [ -n &quot;${words[ $((c+1)) ]}&quot; ] ; then
            flaghash[${flagname}]=${words[ $((c+1)) ]}
        else
            flaghash[${flagname}]=&quot;true&quot; # pad &quot;true&quot; for bool flag
        fi
    fi

    # skip the argument to a two word flag
    if [[ ${words[c]} != *&quot;=&quot;* ]] &amp;&amp; __atmos_contains_word &quot;${words[c]}&quot; &quot;${two_word_flags[@]}&quot;; then
        __atmos_debug &quot;${FUNCNAME[0]}: found a flag ${words[c]}, skip the next argument&quot;
        c=$((c+1))
        # if we are looking for a flags value, don't show commands
        if [[ $c -eq $cword ]]; then
            commands=()
        fi
    fi

    c=$((c+1))

}

__atmos_handle_noun()
{
    __atmos_debug &quot;${FUNCNAME[0]}: c is $c words[c] is ${words[c]}&quot;

    if __atmos_contains_word &quot;${words[c]}&quot; &quot;${must_have_one_noun[@]}&quot;; then
        must_have_one_noun=()
    elif __atmos_contains_word &quot;${words[c]}&quot; &quot;${noun_aliases[@]}&quot;; then
        must_have_one_noun=()
    fi

    nouns+=(&quot;${words[c]}&quot;)
    c=$((c+1))
}

__atmos_handle_command()
{
    __atmos_debug &quot;${FUNCNAME[0]}: c is $c words[c] is ${words[c]}&quot;

    local next_command
    if [[ -n ${last_command} ]]; then
        next_command=&quot;_${last_command}_${words[c]//:/__}&quot;
    else
        if [[ $c -eq 0 ]]; then
            next_command=&quot;_atmos_root_command&quot;
        else
            next_command=&quot;_${words[c]//:/__}&quot;
        fi
    fi
    c=$((c+1))
    __atmos_debug &quot;${FUNCNAME[0]}: looking for ${next_command}&quot;
    declare -F &quot;$next_command&quot; &gt;/dev/null &amp;&amp; $next_command
}

__atmos_handle_word()
{
    if [[ $c -ge $cword ]]; then
        __atmos_handle_reply
        return
    fi
    __atmos_debug &quot;${FUNCNAME[0]}: c is $c words[c] is ${words[c]}&quot;
    if [[ &quot;${words[c]}&quot; == -* ]]; then
        __atmos_handle_flag
    elif __atmos_contains_word &quot;${words[c]}&quot; &quot;${commands[@]}&quot;; then
        __atmos_handle_command
    elif [[ $c -eq 0 ]]; then
        __atmos_handle_command
    elif __atmos_contains_word &quot;${words[c]}&quot; &quot;${command_aliases[@]}&quot;; then
        # aliashash variable is an associative array which is only supported in bash &gt; 3.
        if [[ -z &quot;${BASH_VERSION:-}&quot; || &quot;${BASH_VERSINFO[0]:-}&quot; -gt 3 ]]; then
            words[c]=${aliashash[${words[c]}]}
            __atmos_handle_command
        else
            __atmos_handle_noun
        fi
    else
        __atmos_handle_noun
    fi
    __atmos_handle_word
}

_atmos_atlantis_generate_repo-config()
{
    last_command=&quot;atmos_atlantis_generate_repo-config&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--affected-only&quot;)
    flags+=(&quot;--components=&quot;)
    two_word_flags+=(&quot;--components&quot;)
    flags+=(&quot;--config-template=&quot;)
    two_word_flags+=(&quot;--config-template&quot;)
    flags+=(&quot;--output-path=&quot;)
    two_word_flags+=(&quot;--output-path&quot;)
    flags+=(&quot;--project-template=&quot;)
    two_word_flags+=(&quot;--project-template&quot;)
    flags+=(&quot;--ref=&quot;)
    two_word_flags+=(&quot;--ref&quot;)
    flags+=(&quot;--repo-path=&quot;)
    two_word_flags+=(&quot;--repo-path&quot;)
    flags+=(&quot;--sha=&quot;)
    two_word_flags+=(&quot;--sha&quot;)
    flags+=(&quot;--ssh-key=&quot;)
    two_word_flags+=(&quot;--ssh-key&quot;)
    flags+=(&quot;--ssh-key-password=&quot;)
    two_word_flags+=(&quot;--ssh-key-password&quot;)
    flags+=(&quot;--stacks=&quot;)
    two_word_flags+=(&quot;--stacks&quot;)
    flags+=(&quot;--verbose&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_atlantis_generate()
{
    last_command=&quot;atmos_atlantis_generate&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;repo-config&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_atlantis()
{
    last_command=&quot;atmos_atlantis&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;generate&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_aws_eks_update-kubeconfig()
{
    last_command=&quot;atmos_aws_eks_update-kubeconfig&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--alias=&quot;)
    two_word_flags+=(&quot;--alias&quot;)
    flags+=(&quot;--dry-run&quot;)
    flags+=(&quot;--kubeconfig=&quot;)
    two_word_flags+=(&quot;--kubeconfig&quot;)
    flags+=(&quot;--name=&quot;)
    two_word_flags+=(&quot;--name&quot;)
    flags+=(&quot;--profile=&quot;)
    two_word_flags+=(&quot;--profile&quot;)
    flags+=(&quot;--region=&quot;)
    two_word_flags+=(&quot;--region&quot;)
    flags+=(&quot;--role-arn=&quot;)
    two_word_flags+=(&quot;--role-arn&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--verbose&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_aws_eks()
{
    last_command=&quot;atmos_aws_eks&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;update-kubeconfig&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_aws()
{
    last_command=&quot;atmos_aws&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;eks&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_completion()
{
    last_command=&quot;atmos_completion&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--help&quot;)
    flags+=(&quot;-h&quot;)
    local_nonpersistent_flags+=(&quot;--help&quot;)
    local_nonpersistent_flags+=(&quot;-h&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    must_have_one_noun+=(&quot;bash&quot;)
    must_have_one_noun+=(&quot;fish&quot;)
    must_have_one_noun+=(&quot;powershell&quot;)
    must_have_one_noun+=(&quot;zsh&quot;)
    noun_aliases=()
}

_atmos_describe_affected()
{
    last_command=&quot;atmos_describe_affected&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    flags+=(&quot;--include-spacelift-admin-stacks&quot;)
    flags+=(&quot;--ref=&quot;)
    two_word_flags+=(&quot;--ref&quot;)
    flags+=(&quot;--repo-path=&quot;)
    two_word_flags+=(&quot;--repo-path&quot;)
    flags+=(&quot;--sha=&quot;)
    two_word_flags+=(&quot;--sha&quot;)
    flags+=(&quot;--ssh-key=&quot;)
    two_word_flags+=(&quot;--ssh-key&quot;)
    flags+=(&quot;--ssh-key-password=&quot;)
    two_word_flags+=(&quot;--ssh-key-password&quot;)
    flags+=(&quot;--verbose&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe_component()
{
    last_command=&quot;atmos_describe_component&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe_config()
{
    last_command=&quot;atmos_describe_config&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe_dependents()
{
    last_command=&quot;atmos_describe_dependents&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe_stacks()
{
    last_command=&quot;atmos_describe_stacks&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--component-types=&quot;)
    two_word_flags+=(&quot;--component-types&quot;)
    flags+=(&quot;--components=&quot;)
    two_word_flags+=(&quot;--components&quot;)
    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    flags+=(&quot;--sections=&quot;)
    two_word_flags+=(&quot;--sections&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe_workflows()
{
    last_command=&quot;atmos_describe_workflows&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--output=&quot;)
    two_word_flags+=(&quot;--output&quot;)
    two_word_flags+=(&quot;-o&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_describe()
{
    last_command=&quot;atmos_describe&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;affected&quot;)
    commands+=(&quot;component&quot;)
    commands+=(&quot;config&quot;)
    commands+=(&quot;dependents&quot;)
    if [[ -z &quot;${BASH_VERSION:-}&quot; || &quot;${BASH_VERSINFO[0]:-}&quot; -gt 3 ]]; then
        command_aliases+=(&quot;dependants&quot;)
        aliashash[&quot;dependants&quot;]=&quot;dependents&quot;
    fi
    commands+=(&quot;stacks&quot;)
    commands+=(&quot;workflows&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_docs()
{
    last_command=&quot;atmos_docs&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_helmfile_generate_varfile()
{
    last_command=&quot;atmos_helmfile_generate_varfile&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_helmfile_generate()
{
    last_command=&quot;atmos_helmfile_generate&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;varfile&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_helmfile()
{
    last_command=&quot;atmos_helmfile&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;generate&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flag_parsing_disabled=1
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_help()
{
    last_command=&quot;atmos_help&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    has_completion_function=1
    noun_aliases=()
}

_atmos_terraform_generate_backend()
{
    last_command=&quot;atmos_terraform_generate_backend&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_terraform_generate_backends()
{
    last_command=&quot;atmos_terraform_generate_backends&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--components=&quot;)
    two_word_flags+=(&quot;--components&quot;)
    flags+=(&quot;--file-template=&quot;)
    two_word_flags+=(&quot;--file-template&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    flags+=(&quot;--stacks=&quot;)
    two_word_flags+=(&quot;--stacks&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_terraform_generate_varfile()
{
    last_command=&quot;atmos_terraform_generate_varfile&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_terraform_generate_varfiles()
{
    last_command=&quot;atmos_terraform_generate_varfiles&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--components=&quot;)
    two_word_flags+=(&quot;--components&quot;)
    flags+=(&quot;--file-template=&quot;)
    two_word_flags+=(&quot;--file-template&quot;)
    flags+=(&quot;--format=&quot;)
    two_word_flags+=(&quot;--format&quot;)
    flags+=(&quot;--stacks=&quot;)
    two_word_flags+=(&quot;--stacks&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--file-template=&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_terraform_generate()
{
    last_command=&quot;atmos_terraform_generate&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;backend&quot;)
    commands+=(&quot;backends&quot;)
    commands+=(&quot;varfile&quot;)
    commands+=(&quot;varfiles&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_terraform()
{
    last_command=&quot;atmos_terraform&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;generate&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flag_parsing_disabled=1
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_validate_component()
{
    last_command=&quot;atmos_validate_component&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--module-paths=&quot;)
    two_word_flags+=(&quot;--module-paths&quot;)
    flags+=(&quot;--schema-path=&quot;)
    two_word_flags+=(&quot;--schema-path&quot;)
    flags+=(&quot;--schema-type=&quot;)
    two_word_flags+=(&quot;--schema-type&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--timeout=&quot;)
    two_word_flags+=(&quot;--timeout&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_flag+=(&quot;--stack=&quot;)
    must_have_one_flag+=(&quot;-s&quot;)
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_validate_stacks()
{
    last_command=&quot;atmos_validate_stacks&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--schemas-atmos-manifest=&quot;)
    two_word_flags+=(&quot;--schemas-atmos-manifest&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_validate()
{
    last_command=&quot;atmos_validate&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;component&quot;)
    commands+=(&quot;stacks&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_vendor_pull()
{
    last_command=&quot;atmos_vendor_pull&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--component=&quot;)
    two_word_flags+=(&quot;--component&quot;)
    two_word_flags+=(&quot;-c&quot;)
    flags+=(&quot;--dry-run&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--tags=&quot;)
    two_word_flags+=(&quot;--tags&quot;)
    flags+=(&quot;--type=&quot;)
    two_word_flags+=(&quot;--type&quot;)
    two_word_flags+=(&quot;-t&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_vendor()
{
    last_command=&quot;atmos_vendor&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;pull&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_version()
{
    last_command=&quot;atmos_version&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_workflow()
{
    last_command=&quot;atmos_workflow&quot;

    command_aliases=()

    commands=()

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--dry-run&quot;)
    flags+=(&quot;--file=&quot;)
    two_word_flags+=(&quot;--file&quot;)
    two_word_flags+=(&quot;-f&quot;)
    flags+=(&quot;--from-step=&quot;)
    two_word_flags+=(&quot;--from-step&quot;)
    flags+=(&quot;--stack=&quot;)
    two_word_flags+=(&quot;--stack&quot;)
    two_word_flags+=(&quot;-s&quot;)
    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

_atmos_root_command()
{
    last_command=&quot;atmos&quot;

    command_aliases=()

    commands=()
    commands+=(&quot;atlantis&quot;)
    commands+=(&quot;aws&quot;)
    commands+=(&quot;completion&quot;)
    commands+=(&quot;describe&quot;)
    commands+=(&quot;docs&quot;)
    commands+=(&quot;helmfile&quot;)
    if [[ -z &quot;${BASH_VERSION:-}&quot; || &quot;${BASH_VERSINFO[0]:-}&quot; -gt 3 ]]; then
        command_aliases+=(&quot;hf&quot;)
        aliashash[&quot;hf&quot;]=&quot;helmfile&quot;
    fi
    commands+=(&quot;help&quot;)
    commands+=(&quot;terraform&quot;)
    if [[ -z &quot;${BASH_VERSION:-}&quot; || &quot;${BASH_VERSINFO[0]:-}&quot; -gt 3 ]]; then
        command_aliases+=(&quot;tf&quot;)
        aliashash[&quot;tf&quot;]=&quot;terraform&quot;
    fi
    commands+=(&quot;validate&quot;)
    commands+=(&quot;vendor&quot;)
    commands+=(&quot;version&quot;)
    commands+=(&quot;workflow&quot;)

    flags=()
    two_word_flags=()
    local_nonpersistent_flags=()
    flags_with_completion=()
    flags_completion=()

    flags+=(&quot;--logs-file=&quot;)
    two_word_flags+=(&quot;--logs-file&quot;)
    flags+=(&quot;--logs-level=&quot;)
    two_word_flags+=(&quot;--logs-level&quot;)
    flags+=(&quot;--redirect-stderr=&quot;)
    two_word_flags+=(&quot;--redirect-stderr&quot;)

    must_have_one_flag=()
    must_have_one_noun=()
    noun_aliases=()
}

__start_atmos()
{
    local cur prev words cword split
    declare -A flaghash 2&gt;/dev/null || :
    declare -A aliashash 2&gt;/dev/null || :
    if declare -F _init_completion &gt;/dev/null 2&gt;&amp;1; then
        _init_completion -s || return
    else
        __atmos_init_completion -n &quot;=&quot; || return
    fi

    local c=0
    local flag_parsing_disabled=
    local flags=()
    local two_word_flags=()
    local local_nonpersistent_flags=()
    local flags_with_completion=()
    local flags_completion=()
    local commands=(&quot;atmos&quot;)
    local command_aliases=()
    local must_have_one_flag=()
    local must_have_one_noun=()
    local has_completion_function=&quot;&quot;
    local last_command=&quot;&quot;
    local nouns=()
    local noun_aliases=()

    __atmos_handle_word
}

if [[ $(type -t compopt) = &quot;builtin&quot; ]]; then
    complete -o default -F __start_atmos atmos
else
    complete -o default -o nospace -F __start_atmos atmos
fi

# ex: ts=4 sw=4 et filetype=sh
