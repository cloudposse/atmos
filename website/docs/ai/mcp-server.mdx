---
title: MCP Server Integration
sidebar_position: 6
sidebar_label: MCP Server
description: Connect Atmos AI tools to any MCP-compatible client
id: mcp-server
---
import Terminal from '@site/src/components/Terminal'
import File from '@site/src/components/File'

# MCP Server Integration

The Atmos MCP Server exposes Atmos AI tools through the Model Context Protocol (MCP), enabling integration with any MCP-compatible client such as Claude Desktop, Claude Code, VSCode extensions, and custom applications.

:::info What is MCP?
The [Model Context Protocol](https://modelcontextprotocol.io) is an open standard created by Anthropic that standardizes how AI systems connect to external data sources and tools. Think of it as "USB-C for AI" - a universal way for any AI assistant to connect to any tool without requiring custom integrations.
:::

:::danger Security Warning
The MCP server does not include built-in authentication or encryption. **HTTP transport exposes your infrastructure data to anyone who can reach the port.** Use with caution:

- **stdio transport (default)**: Secure for local use only
- **HTTP transport**: Requires additional security measures (firewall, VPN, reverse proxy with auth)

See [Security Considerations](#security-considerations) below for detailed guidance.
:::

## Overview

The MCP server allows you to use Atmos infrastructure management capabilities from any AI assistant that supports the MCP protocol:

### Desktop Applications
- **Claude Desktop**: Use Atmos tools directly in Claude conversations
- **Cursor**: AI-first code editor with deep MCP integration
- **Windsurf**: AI-powered development environment

### VS Code Extensions
- **GitHub Copilot**: Microsoft's AI coding assistant with MCP support
- **Cline**: Autonomous coding agent that creates and adds tools
- **Continue.dev**: Multi-model AI assistant with comprehensive MCP features

### Other Integrations
- **100+ Applications**: The MCP protocol is supported by a growing ecosystem of tools
- **Custom Clients**: Build your own MCP-compatible applications using official SDKs

## Features

### Two Transport Modes

**stdio Transport (Default)**
- Local subprocess communication via standard input/output
- Perfect for desktop applications and local development
- Simple configuration with no network setup required
- Secure - runs as a local process only

**HTTP Transport**
- Network-accessible via HTTP with Server-Sent Events (SSE)
- Supports multiple concurrent clients
- Ideal for remote/cloud environments and team collaboration
- Health check endpoint for monitoring

### Available Tools

When connected, the MCP server exposes all enabled Atmos AI tools:

- `atmos_describe_component` - Get detailed component configuration
- `atmos_list_stacks` - List and filter stacks
- `atmos_validate_stacks` - Validate stack configurations
- `atmos_terraform_plan` - Generate Terraform plans
- `atmos_read_component_file` - Read component files
- `atmos_read_stack_file` - Read stack files
- `atmos_write_component_file` - Modify component files (with permission)
- `atmos_write_stack_file` - Modify stack files (with permission)

All tools respect your configured [permission settings](/ai/tools#permission-system).

## Quick Start

Get started with Claude Desktop in 5 minutes:

### 1. Verify Prerequisites

<Terminal title="verify installation">
```bash
# Check Atmos is installed
atmos version

# Check atmos is in PATH
which atmos
```
</Terminal>

Requirements:
- **Atmos**: v1.63.0 or later
- **Claude Desktop**: v0.7.0 or later ([Download](https://claude.ai/download))

### 2. Enable AI in atmos.yaml

<File title="atmos.yaml">
```yaml
settings:
  ai:
    enabled: true
    tools:
      enabled: true
      require_confirmation: false  # Optional: set to false for smoother experience
```
</File>

### 3. Configure Claude Desktop

Create or edit the configuration file:

**macOS/Linux:**
<Terminal title="setup config">
```bash
# Create config directory if it doesn't exist
mkdir -p ~/.config/claude

# Create/edit configuration file
nano ~/.config/claude/claude_desktop_config.json
```
</Terminal>

**Windows:**
<Terminal title="setup config">
```powershell
# Create config directory if it doesn't exist
New-Item -Path "$env:APPDATA\Claude" -ItemType Directory -Force

# Create/edit configuration file
notepad "$env:APPDATA\Claude\claude_desktop_config.json"
```
</Terminal>

Add this configuration:

<File title="claude_desktop_config.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "/path/to/your/atmos/project"
    }
  }
}
```
</File>

:::tip Working Directory
The `cwd` (current working directory) parameter tells the MCP server where to find your `atmos.yaml` file. Replace `/path/to/your/atmos/project` with the actual path to your Atmos project.
:::

### 4. Restart Claude Desktop

After saving the configuration:
1. Completely quit Claude Desktop (not just close the window)
2. Restart Claude Desktop
3. Wait a few seconds for MCP servers to initialize

### 5. Verify Connection

Look for the **MCP indicator** in Claude Desktop:

1. **Check the status icon**: Look for the üîå (plug) icon in the bottom-right corner of the Claude Desktop window
2. **Click the icon**: You should see "atmos" listed with a green dot (‚óè connected) or yellow dot (‚óè initializing)
3. **Test with a query**: Ask Claude: "Can you list my Atmos stacks?"

Claude should respond using the `atmos_list_stacks` tool and show your actual stack names.

:::info First Connection
The first time Claude Desktop connects, it may take 5-10 seconds to initialize. If you see a yellow indicator, wait a moment before testing.
:::

### 6. Try Example Queries

Once connected, try these questions:

**Infrastructure Discovery:**
```
List all my Atmos stacks
Show me the configuration for the vpc component in prod-us-east-1
What stacks are using the RDS component?
```

**Validation:**
```
Validate all my stack configurations
Check if my dev-us-west-2 stack is valid
```

**Configuration Review:**
```
Show me the stack file for production
What are the configured variables for the vpc component?
```

## Configuration

### Prerequisites

1. **Atmos** (v1.63.0 or later):

<Terminal title="check version">
```bash
atmos version
```
</Terminal>

2. **Claude Desktop** (v0.7.0 or later) for MCP support:
   - Download from: https://claude.ai/download
   - Verify version in: Settings ‚Üí About

3. **Enable AI features** in your `atmos.yaml`:

<File title="atmos.yaml">
```yaml
settings:
  ai:
    enabled: true
    default_provider: "anthropic"
    providers:
      anthropic:
        model: "claude-sonnet-4-20250514"
        api_key_env: "ANTHROPIC_API_KEY"

    # Enable tools for MCP access
    tools:
      enabled: true
      require_confirmation: true
      allowed_tools:
        - atmos_describe_component
        - atmos_list_stacks
        - atmos_validate_stacks
```
</File>

2. **Set your API key** (for AI provider, not MCP itself):

<Terminal title="shell">
```bash
export ANTHROPIC_API_KEY="your-api-key-here"
```
</Terminal>

:::note
The MCP server itself does not require authentication in v1. The tools it exposes use your configured AI provider settings.
:::

## Usage

### stdio Transport (Desktop Clients)

The default stdio transport is ideal for local desktop applications like Claude Desktop.

#### Start the Server

<Terminal title="atmos mcp-server">
```bash
atmos mcp-server
```
</Terminal>

The server will start and wait for client connections via stdin/stdout.

#### Claude Desktop Configuration

Add Atmos to your Claude Desktop configuration:

**macOS/Linux** (`~/.config/claude/claude_desktop_config.json`):

<File title="claude_desktop_config.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "/path/to/your/atmos/project"
    }
  }
}
```
</File>

**Windows** (`%APPDATA%\Claude\claude_desktop_config.json`):

<File title="claude_desktop_config.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos.exe",
      "args": ["mcp-server"],
      "cwd": "C:\\Users\\YourName\\atmos-project"
    }
  }
}
```
</File>

:::tip Configuration Options
- **`cwd`**: Working directory where `atmos.yaml` is located (recommended)
- **`env`**: Environment variables (optional, see below)
- **`command`**: Use full path if `atmos` is not in PATH
:::

**Advanced: Environment Variables and Custom Paths**

If you need to pass environment variables or use a custom Atmos installation:

<File title="claude_desktop_config.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "/usr/local/bin/atmos",
      "args": ["mcp-server"],
      "cwd": "/home/user/infrastructure",
      "env": {
        "ANTHROPIC_API_KEY": "your-key-here",
        "ATMOS_BASE_PATH": "/home/user/infrastructure"
      }
    }
  }
}
```
</File>

**Windows with Custom Path:**

<File title="claude_desktop_config.json (Windows)">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "C:\\Program Files\\atmos\\atmos.exe",
      "args": ["mcp-server"],
      "cwd": "C:\\Users\\YourName\\infrastructure"
    }
  }
}
```
</File>

:::warning Windows Paths
Use double backslashes `\\` in JSON for Windows paths, or use forward slashes `/` which also work on Windows.
:::

#### Verify the Connection

After adding the configuration:

1. **Restart Claude Desktop** - Completely quit and reopen (required for config changes)
2. **Wait for initialization** - MCP servers take 5-10 seconds to start on first connection
3. **Check the MCP status icon** - Look for üîå in the bottom-right corner
4. **Verify Atmos is connected**:
   - Click the üîå icon
   - Look for "atmos" in the server list
   - Green dot (‚óè) = connected
   - Yellow dot (‚óè) = initializing
   - Red dot (‚óè) = error (check logs)

5. **Test with a simple query**:
   Ask Claude: "Can you list my Atmos stacks using the atmos_list_stacks tool?"

6. **Check Claude Desktop logs** if tools don't appear:
   - **macOS**: `~/Library/Logs/Claude/mcp*.log`
   - **Windows**: `%APPDATA%\Claude\logs\mcp*.log`
   - **Linux**: `~/.config/Claude/logs/mcp*.log`

#### Other MCP Clients

Beyond Claude Desktop, the Atmos MCP server works with many popular development tools and AI assistants.

##### VS Code with GitHub Copilot

**Prerequisites**: VS Code with GitHub Copilot extension installed

**Configuration Location**: `.vscode/mcp.json` (workspace) or global via Command Palette

Create or edit `.vscode/mcp.json` in your project:

<File title=".vscode/mcp.json">
```json
{
  "servers": {
    "atmos": {
      "type": "stdio",
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "${workspaceFolder}"
    }
  }
}
```
</File>

**Alternative Setup via Command Palette**:
1. Press `Cmd+Shift+P` (macOS) or `Ctrl+Shift+P` (Windows/Linux)
2. Search for "MCP: Add Server"
3. Choose workspace or global configuration
4. Configure the Atmos server

VS Code will prompt you to trust the server on first use.

:::tip VS Code Configuration
VS Code can automatically detect MCP configurations from Claude Desktop. Enable `chat.mcp.discovery.enabled` in settings to reuse your Claude Desktop configuration.
:::

##### Cursor IDE

**Configuration Location**: `~/.cursor/mcp.json` (global) or `.cursor/mcp.json` (project)

<File title="~/.cursor/mcp.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "/path/to/your/atmos/project",
      "env": {
        "ATMOS_BASE_PATH": "/path/to/your/atmos/project"
      }
    }
  }
}
```
</File>

**GUI Setup**:
1. Open Cursor Settings ‚Üí Tools & Integrations
2. Click "New MCP Server"
3. Enter server details
4. Save configuration

**Manual Setup**:
1. Go to Settings ‚Üí Developer ‚Üí Edit Config
2. Select "MCP Tools"
3. Click "Add Custom MCP"
4. Edit the `mcp.json` file

##### Cline (VS Code Extension)

**Prerequisites**: Install [Cline extension](https://marketplace.visualstudio.com/items?itemName=saoudrizwan.claude-dev) from VS Code Marketplace

**Configuration**:
1. Click the "MCP Servers" icon in Cline's top navigation
2. Click "Configure MCP Servers" to open `cline_mcp_settings.json`
3. Add Atmos configuration:

<File title="cline_mcp_settings.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "/path/to/your/atmos/project",
      "env": {},
      "alwaysAllow": [],
      "disabled": false
    }
  }
}
```
</File>

**Configuration Options**:
- `alwaysAllow`: Array of tool names to auto-approve (e.g., `["atmos_list_stacks"]`)
- `disabled`: Set to `true` to temporarily disable the server
- Network timeout: Default 1 minute, configurable from 30s to 1 hour

##### Continue.dev (VS Code Extension)

**Prerequisites**: Install [Continue extension](https://marketplace.visualstudio.com/items?itemName=Continue.continue) from VS Code Marketplace

**Configuration Method 1 - Dedicated Folder**:

Create `.continue/mcpServers/atmos.yaml` in your workspace:

<File title=".continue/mcpServers/atmos.yaml">
```yaml
name: atmos
command: atmos
args:
  - mcp-server
cwd: /path/to/your/atmos/project
env:
  ATMOS_BASE_PATH: /path/to/your/atmos/project
```
</File>

**Configuration Method 2 - Main Config**:

Edit `.continue/config.yaml`:

<File title=".continue/config.yaml">
```yaml
mcpServers:
  - name: atmos
    command: atmos
    args:
      - mcp-server
    cwd: /path/to/your/atmos/project
    env:
      ATMOS_BASE_PATH: /path/to/your/atmos/project
```
</File>

##### Windsurf IDE

Windsurf uses a similar configuration to Cursor:

<File title="~/.windsurf/mcp.json">
```json
{
  "mcpServers": {
    "atmos": {
      "command": "atmos",
      "args": ["mcp-server"],
      "cwd": "/path/to/your/atmos/project"
    }
  }
}
```
</File>

##### Client Comparison

| Client | Best For | Configuration | MCP Features |
|--------|----------|---------------|--------------|
| **Claude Desktop** | General AI chat, infrastructure queries | Simple JSON config | Tools, Resources, Prompts |
| **VS Code Copilot** | Coding with AI assistance | `.vscode/mcp.json` | Tools, Resources |
| **Cursor** | AI-first code editor | `~/.cursor/mcp.json` | Tools, Resources, Prompts |
| **Cline** | Autonomous coding agent | GUI + JSON config | Tools, Resources |
| **Continue.dev** | Multi-model code assistant | YAML config | Tools, Resources |
| **Windsurf** | AI code editor | Similar to Cursor | Tools, Resources |

:::tip Choosing a Client
- **Claude Desktop**: Best for general infrastructure management and queries
- **VS Code/Cursor/Cline**: Best for coding while having Atmos context
- **Continue.dev**: Best if you want to use multiple AI models
- **HTTP transport**: Best for team collaboration and CI/CD pipelines
:::

### HTTP Transport (Remote/Cloud)

The HTTP transport is ideal for remote access, cloud environments, and multiple concurrent clients.

#### Start HTTP Server

<Terminal title="atmos mcp-server --transport http">
```bash
# Default: localhost:8080
atmos mcp-server --transport http

# Custom host and port
atmos mcp-server --transport http --host 0.0.0.0 --port 3000

# Bind to all interfaces for remote access
atmos mcp-server --transport http --host 0.0.0.0 --port 8080
```
</Terminal>

The server provides three endpoints:

- **GET `/sse`** - Server-Sent Events endpoint for client streaming
- **POST `/message`** - JSON-RPC 2.0 message endpoint
- **GET `/health`** - Health check endpoint

#### Health Check

<Terminal title="curl">
```bash
curl http://localhost:8080/health
```
```json
{
  "status": "healthy",
  "clients": 2
}
```
</Terminal>

#### Cloud Desktop Configuration

For remote access from Cloud Desktop or web clients:

<File title="claude_desktop_config.json">
```json
{
  "mcpServers": {
    "atmos-remote": {
      "transport": "http",
      "url": "http://your-server:8080"
    }
  }
}
```
</File>

## Command Reference

### Flags

| Flag | Default | Description |
|------|---------|-------------|
| `--transport` | `stdio` | Transport type: `stdio` or `http` |
| `--host` | `localhost` | Host to bind HTTP server (HTTP only) |
| `--port` | `8080` | Port to bind HTTP server (HTTP only) |

### Examples

<Terminal title="examples">
```bash
# Start with stdio transport (default)
atmos mcp-server

# Start HTTP server on default port
atmos mcp-server --transport http

# Start HTTP server on custom port
atmos mcp-server --transport http --port 3000

# Start HTTP server accessible from network
atmos mcp-server --transport http --host 0.0.0.0 --port 8080
```
</Terminal>

## Use Cases

### Local Development (stdio)
- **Claude Desktop integration** - Use Atmos tools in Claude conversations
- **VSCode development** - Access infrastructure context while coding
- **Personal productivity** - Quick infrastructure queries from AI assistant

### Team Collaboration (HTTP)
- **Shared infrastructure server** - Team members connect to central MCP server
- **CI/CD integration** - Automated pipelines query infrastructure via MCP
- **Cloud Desktop** - Remote access to Atmos capabilities
- **Containerized deployments** - Run MCP server in Docker/Kubernetes

### Custom Applications (Both)
- **Custom MCP clients** - Build your own applications using Atmos tools
- **Integration platforms** - Connect Atmos to workflow automation
- **Monitoring dashboards** - Real-time infrastructure queries

## Example Queries

Once your MCP server is connected to Claude Desktop, try these practical queries:

### Infrastructure Discovery

<Terminal title="claude queries">
```
List all my Atmos stacks

Show me the configuration for the vpc component in prod-us-east-1

What stacks are using the RDS component?

What are all the components defined in my infrastructure?

Show me the differences between dev and prod configurations for the vpc component
```
</Terminal>

### Validation and Verification

<Terminal title="validation queries">
```
Validate all my stack configurations

Check if my dev-us-west-2 stack is valid

Are there any configuration errors in my production stacks?

Validate the VPC component configuration across all environments
```
</Terminal>

### Configuration Review

<Terminal title="config queries">
```
Show me the stack file for prod-us-east-1

What are the configured variables for the vpc component?

What's the current configuration for the RDS database in staging?

Show me the terraform.backend configuration for production
```
</Terminal>

### Planning and Changes

<Terminal title="planning queries">
```
Generate a Terraform plan for the vpc component in staging

What would change if I apply the RDS component in prod-us-east-1?

Show me the planned changes for all components in dev-us-west-2
```
</Terminal>

### File Operations

<Terminal title="file queries">
```
Read the stack configuration file for prod-us-east-1

Show me the contents of the vpc component file

What's in my atmos.yaml configuration file?

List all available component files
```
</Terminal>

:::tip Natural Language
You don't need to use exact tool names. Claude understands natural language and will automatically select the appropriate Atmos tools based on your question.
:::

## Architecture

### stdio Transport Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Claude Desktop  ‚îÇ
‚îÇ   Claude Code   ‚îÇ
‚îÇ     VSCode      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ subprocess
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  atmos mcp-     ‚îÇ
‚îÇ     server      ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ  (stdio)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Atmos AI Tools ‚îÇ
‚îÇ  ‚Ä¢ list_stacks  ‚îÇ
‚îÇ  ‚Ä¢ describe_*   ‚îÇ
‚îÇ  ‚Ä¢ validate_*   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### HTTP Transport Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cloud Desktop  ‚îÇ     ‚îÇ  Custom Client  ‚îÇ
‚îÇ   Web Client    ‚îÇ     ‚îÇ  CI/CD Pipeline ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ
         ‚îÇ HTTP/SSE             ‚îÇ HTTP/SSE
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  atmos mcp-server   ‚îÇ
         ‚îÇ                     ‚îÇ
         ‚îÇ  GET  /sse          ‚îÇ
         ‚îÇ  POST /message      ‚îÇ
         ‚îÇ  GET  /health       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   Atmos AI Tools    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Server Execution Model

Understanding how MCP servers run helps clarify their behavior and operational requirements.

### stdio Transport: Foreground Subprocess Execution

**All MCP servers using stdio transport run in the foreground as blocking processes.** This is the industry standard defined by the MCP specification and followed by all major implementations.

#### How It Works

1. **Client Launches Server as Subprocess**
   - When Claude Desktop starts, it spawns `atmos mcp-server` as a child process
   - The server process is directly managed by the client application
   - Process lifecycle is tied to the client session

2. **Blocking Execution Loop**
   - The server enters a blocking loop reading from stdin
   - Each incoming message is processed synchronously
   - The main thread remains blocked until shutdown

3. **Clean Shutdown Process**
   - Client closes stdin when disconnecting
   - Server detects EOF and exits gracefully
   - Signal handlers (SIGTERM/SIGINT) allow manual interruption
   - Process cleanup happens automatically

#### Why Foreground Execution?

This design choice provides several benefits:

**Process Lifecycle Control**
- Client can terminate the subprocess when done
- No orphaned processes or daemon management needed
- Automatic cleanup when client crashes

**Resource Management**
- When the client dies, the server dies automatically
- No need for PID files or process tracking
- Simple memory and file handle cleanup

**Cross-Platform Compatibility**
- Works identically on Windows, macOS, and Linux
- No platform-specific daemon management
- Consistent behavior across environments

**Debugging and Monitoring**
- Server output appears in client logs
- Easy to diagnose connection issues
- Simple to trace request/response flow

**Security Through Isolation**
- Process runs under the same user as the client
- Inherits client's security context and permissions
- No additional privilege escalation

#### MCP Specification Requirements

From the [official MCP specification](https://modelcontextprotocol.io/specification/2025-03-26/basic/transports):

> "The client launches the MCP server as a subprocess and the server reads JSON-RPC messages from its standard input (stdin) and sends messages to its standard output (stdout)."

Key requirements for stdio transport:
- Messages are newline-delimited
- Server reads from stdin, writes to stdout
- Logging goes to stderr (not stdout)
- Server blocks until client disconnects

### HTTP Transport: Background Daemon Execution

Unlike stdio, **HTTP transport servers can run as background daemons:**

```bash
# Start HTTP server in background
atmos mcp-server --transport http --host 0.0.0.0 --port 8080 &

# Or use process managers
systemctl start atmos-mcp-server  # systemd
docker run -d atmos-mcp           # Docker
```

HTTP servers:
- ‚úÖ Run independently of any client
- ‚úÖ Handle multiple concurrent connections
- ‚úÖ Suitable for production deployments
- ‚úÖ Can be daemonized with systemd, Docker, etc.
- ‚ö†Ô∏è Require additional security measures (authentication, TLS)

### Execution Model Comparison

| Aspect | stdio Transport | HTTP Transport |
|--------|----------------|----------------|
| **Execution Mode** | Foreground (blocking) | Background (daemon) |
| **Process Launch** | Client spawns subprocess | Manually started/managed |
| **Lifecycle** | Tied to client session | Independent of clients |
| **Multiple Clients** | No (1:1 relationship) | Yes (1:many) |
| **Startup** | Automatic by client | Manual or via init system |
| **Shutdown** | When client disconnects | Manual or signal-based |
| **Resource Cleanup** | Automatic with client | Requires proper shutdown |
| **Production Use** | Desktop applications | Server/cloud deployments |

### Common Misconceptions

:::tip Understanding Foreground Execution
Running in the foreground is **not a limitation** for stdio servers‚Äîit's the designed behavior that ensures:
- Clean process management
- Automatic resource cleanup
- Protocol compliance
- Cross-platform consistency

This is how **all** MCP stdio servers work, including official reference implementations.
:::

**"Should I run stdio servers in the background?"**

No. stdio servers are designed to run as foreground subprocesses. If you need a background server:
- Use HTTP transport instead: `atmos mcp-server --transport http`
- Set up proper daemon management (systemd, Docker, etc.)
- Implement security measures (authentication, TLS)

**"Can I detach the stdio server from Claude Desktop?"**

No. The stdio protocol requires the client to maintain the subprocess connection. Detaching would break the communication channel.

**"Why does the server exit when I close Claude Desktop?"**

This is correct behavior. The stdio server's lifecycle is tied to the client. When Claude Desktop quits, it terminates its child processes, including the MCP server.

### Best Practices

Following these practices ensures reliable MCP server operation:

**For stdio Transport (Local Development):**
- ‚úÖ Let the client manage the process lifecycle
- ‚úÖ Use stderr for logging, stdout for protocol messages only
- ‚úÖ Implement graceful shutdown on signal handlers
- ‚úÖ Handle context cancellation properly
- ‚ùå Don't try to daemonize or detach the process
- ‚ùå Don't write non-protocol data to stdout

**For HTTP Transport (Production):**
- ‚úÖ Use process managers (systemd, Docker, Kubernetes)
- ‚úÖ Implement health check endpoints
- ‚úÖ Add proper monitoring and logging
- ‚úÖ Configure authentication and TLS
- ‚úÖ Set up graceful shutdown procedures
- ‚ùå Don't expose unauthenticated HTTP servers to the internet

## Security Considerations

### Current Security Model (v1)

:::warning No Built-in Authentication
The v1 MCP server does not include built-in authentication or encryption. Consider these security implications:
:::

**stdio Transport**
- ‚úÖ Runs as local subprocess under your user account
- ‚úÖ No network exposure
- ‚úÖ Inherits file system permissions
- ‚ö†Ô∏è Any local process can connect if they can spawn the binary

**HTTP Transport**
- ‚ö†Ô∏è No authentication by default
- ‚ö†Ô∏è No encryption (HTTP only, not HTTPS)
- ‚ö†Ô∏è Accessible to anyone who can reach the port
- ‚ö†Ô∏è All clients share the same permission context

### Security Best Practices

For production deployments with HTTP transport:

1. **Network Security**
   - Use firewall rules to restrict access
   - Run on private networks only
   - Use VPN for remote access
   - Consider SSH tunneling for secure remote access

2. **Access Control**
   - Bind to `localhost` only for single-user scenarios
   - Use reverse proxy with authentication (nginx, Caddy)
   - Implement network-level access controls

3. **Tool Permissions**
   - Configure restrictive tool permissions in `atmos.yaml`
   - Disable write operations if not needed
   - Use `blocked_tools` to prevent sensitive operations

4. **Monitoring**
   - Monitor the `/health` endpoint
   - Log all tool executions
   - Alert on suspicious activity

### SSH Tunnel Example

For secure remote access:

<Terminal title="ssh tunnel">
```bash
# On your local machine
ssh -L 8080:localhost:8080 user@remote-server

# On the remote server
atmos mcp-server --transport http --host localhost --port 8080

# Now access via localhost:8080 on your local machine
```
</Terminal>

### Future Security Features

Planned for future releases:

- **Authentication** - API key and JWT token support
- **TLS/HTTPS** - Encrypted connections
- **Rate Limiting** - Prevent abuse
- **Audit Logging** - Detailed operation logs
- **Role-Based Access** - Per-client permissions

## Troubleshooting

### Connection Issues (stdio)

**Claude Desktop not showing Atmos server:**

1. **Verify configuration file location and syntax:**
   - macOS/Linux: `~/.config/claude/claude_desktop_config.json`
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`
   - Validate JSON syntax (use https://jsonlint.com)

2. **Restart Claude Desktop properly:**
   - Completely quit the application (Cmd+Q on macOS, not just close window)
   - Wait 5 seconds
   - Reopen Claude Desktop

3. **Verify `atmos` is in PATH:**
   <Terminal title="verify path">
   ```bash
   # Check if atmos is accessible
   which atmos

   # Test the MCP server command directly
   atmos mcp-server
   # Should output: "MCP server started (stdio transport)"
   # Press Ctrl+C to exit
   ```
   </Terminal>

4. **Check Claude Desktop logs:**
   - **macOS**: `~/Library/Logs/Claude/mcp*.log`
   - **Windows**: `%APPDATA%\Claude\logs\mcp*.log`
   - **Linux**: `~/.config/Claude/logs/mcp*.log`

   Look for errors containing "atmos" or "mcp-server"

**Tools not appearing in Claude conversations:**

1. **Verify MCP server is connected:**
   - Click the üîå icon in bottom-right corner of Claude Desktop
   - "atmos" should show green dot (‚óè connected)
   - If yellow (‚óè initializing), wait 10 seconds
   - If red (‚óè error), check logs for error messages

2. **Explicitly ask Claude to use tools:**

   Instead of: "What stacks do I have?"

   Try: "Use the atmos_list_stacks tool to show my stacks"

3. **Check tool permissions in `atmos.yaml`:**
   <File title="atmos.yaml">
   ```yaml
   settings:
     ai:
       enabled: true
       tools:
         enabled: true  # Must be true
         require_confirmation: false  # Set to false for automatic execution

         # Ensure tools are not blocked
         blocked_tools: []

         # Or explicitly allow tools
         allowed_tools:
           - atmos_list_stacks
           - atmos_describe_component
           - atmos_validate_stacks
   ```
   </File>

4. **Verify working directory is correct:**

   Add `cwd` to your Claude Desktop config to ensure Atmos finds your `atmos.yaml`:
   <File title="claude_desktop_config.json">
   ```json
   {
     "mcpServers": {
       "atmos": {
         "command": "atmos",
         "args": ["mcp-server"],
         "cwd": "/full/path/to/your/atmos/project"
       }
     }
   }
   ```
   </File>

5. **Test the MCP server manually:**
   <Terminal title="manual test">
   ```bash
   cd /path/to/your/atmos/project
   atmos mcp-server
   # Should start without errors
   # Press Ctrl+C to exit
   ```
   </Terminal>

**"Command not found" errors:**
<Terminal title="solution">
```bash
# Find atmos binary location
which atmos

# Use full path in config if needed
{
  "mcpServers": {
    "atmos": {
      "command": "/usr/local/bin/atmos",
      "args": ["mcp-server"]
    }
  }
}
```
</Terminal>

### Connection Issues (HTTP)

**Cannot connect to HTTP server:**
<Terminal title="debug">
```bash
# Check if server is running
curl http://localhost:8080/health

# Check if port is in use
lsof -i :8080

# Test with different port
atmos mcp-server --transport http --port 3000
```
</Terminal>

**Firewall blocking connections:**
<Terminal title="firewall">
```bash
# macOS: Allow incoming connections
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add atmos
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblock atmos

# Linux: Allow port in firewall
sudo ufw allow 8080/tcp
```
</Terminal>

### Configuration Issues

**Configuration file not found:**

If Claude Desktop can't find the config file, create it:

**macOS/Linux:**
<Terminal title="create config">
```bash
# Create directory
mkdir -p ~/.config/claude

# Create file with proper structure
cat > ~/.config/claude/claude_desktop_config.json << 'EOF'
{
  "mcpServers": {}
}
EOF

# Now edit to add Atmos server
nano ~/.config/claude/claude_desktop_config.json
```
</Terminal>

**Windows:**
<Terminal title="create config">
```powershell
# Create directory
New-Item -Path "$env:APPDATA\Claude" -ItemType Directory -Force

# Create file
@'
{
  "mcpServers": {}
}
'@ | Out-File -FilePath "$env:APPDATA\Claude\claude_desktop_config.json" -Encoding UTF8

# Now edit to add Atmos server
notepad "$env:APPDATA\Claude\claude_desktop_config.json"
```
</Terminal>

**"AI tools are not enabled" error:**

Enable AI tools in your configuration:

<File title="atmos.yaml">
```yaml
settings:
  ai:
    enabled: true
    tools:
      enabled: true  # This must be true
```
</File>

**Tools not executing:**

Check your permission settings:

<File title="atmos.yaml">
```yaml
settings:
  ai:
    tools:
      enabled: true
      # Remove if too restrictive
      blocked_tools: []

      # Add tools to allowed list
      allowed_tools:
        - atmos_describe_component
        - atmos_list_stacks
```
</File>

### Performance Issues

**Slow responses:**
1. Increase timeout: `settings.ai.timeout_seconds: 120`
2. Reduce context size: `settings.ai.max_context_files: 5`
3. Check network latency (for HTTP transport)
4. Monitor system resources

**Memory usage:**
1. Limit concurrent clients (HTTP transport)
2. Reduce message buffer size
3. Monitor with: `curl http://localhost:8080/health`

## Advanced Usage

### Docker Deployment

Run MCP server in a container:

<File title="Dockerfile">
```dockerfile
FROM cloudposse/atmos:latest

# Copy your Atmos configuration
COPY atmos.yaml /atmos/atmos.yaml
COPY stacks/ /atmos/stacks/
COPY components/ /atmos/components/

WORKDIR /atmos

EXPOSE 8080

CMD ["atmos", "mcp-server", "--transport", "http", "--host", "0.0.0.0", "--port", "8080"]
```
</File>

<Terminal title="docker">
```bash
# Build
docker build -t atmos-mcp .

# Run
docker run -p 8080:8080 \
  -e ANTHROPIC_API_KEY="${ANTHROPIC_API_KEY}" \
  atmos-mcp

# Health check
curl http://localhost:8080/health
```
</Terminal>

### Kubernetes Deployment

<File title="deployment.yaml">
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: atmos-mcp-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: atmos-mcp
  template:
    metadata:
      labels:
        app: atmos-mcp
    spec:
      containers:
      - name: atmos-mcp
        image: atmos-mcp:latest
        ports:
        - containerPort: 8080
        env:
        - name: ANTHROPIC_API_KEY
          valueFrom:
            secretKeyRef:
              name: ai-credentials
              key: anthropic-api-key
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 30
---
apiVersion: v1
kind: Service
metadata:
  name: atmos-mcp-service
spec:
  selector:
    app: atmos-mcp
  ports:
  - port: 8080
    targetPort: 8080
```
</File>

### Reverse Proxy with Authentication

Example nginx configuration with basic auth:

<File title="nginx.conf">
```nginx
upstream atmos_mcp {
    server localhost:8080;
}

server {
    listen 443 ssl http2;
    server_name atmos-mcp.example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # Basic authentication
    auth_basic "Atmos MCP Server";
    auth_basic_user_file /etc/nginx/.htpasswd;

    location / {
        proxy_pass http://atmos_mcp;
        proxy_http_version 1.1;

        # SSE support
        proxy_set_header Connection '';
        proxy_buffering off;
        proxy_cache off;

        # Headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /sse {
        proxy_pass http://atmos_mcp/sse;
        proxy_http_version 1.1;

        # SSE requires these settings
        proxy_set_header Connection '';
        proxy_set_header Cache-Control 'no-cache';
        proxy_buffering off;
        chunked_transfer_encoding on;
    }
}
```
</File>

## Comparison with Embedded AI

Atmos offers two ways to use AI capabilities:

| Feature | `atmos ai chat` | `atmos mcp-server` |
|---------|----------------|-------------------|
| **Access** | Built-in CLI | Any MCP client |
| **Interface** | Terminal TUI | Client-dependent |
| **Use Case** | Direct CLI usage | Integration with AI assistants |
| **Session Management** | ‚úÖ Built-in | ‚ùå Client-managed |
| **Project Memory** | ‚úÖ Built-in | ‚ùå Not available |
| **Portability** | ‚ùå Atmos CLI only | ‚úÖ Universal (MCP standard) |
| **Setup** | Simple | Requires client configuration |

**When to use each:**

- **Use `atmos ai chat`** when working directly in the terminal
- **Use `atmos mcp-server`** when integrating with Claude Desktop, VSCode, or custom applications

You can use both simultaneously - they're complementary features!

## Related Documentation

### Atmos Documentation
- [AI Configuration](/ai/configuration) - Configure AI provider settings
- [AI Tools](/ai/tools) - Available tools and permissions

### MCP Protocol Resources
- [MCP Official Documentation](https://modelcontextprotocol.io/docs/getting-started/intro) - Getting started with MCP
- [MCP Specification](https://modelcontextprotocol.io) - Official protocol specification
- [MCP Best Practices](https://modelcontextprotocol.info/docs/best-practices/) - Architecture and implementation guide
- [MCP Community Hub](https://modelcontextprotocol.info/) - Community resources and guides

### MCP Server Implementations
- [Official MCP Servers](https://github.com/modelcontextprotocol/servers) - Reference implementations and examples
- [MCP Go SDK](https://github.com/modelcontextprotocol/go-sdk) - Official Go SDK for building MCP servers

### Setup Guides
- [Claude Desktop Guide](https://claude.ai/desktop) - Claude Desktop setup and usage
- [Notes on Setting Up Claude Desktop MCP Servers](https://nishtahir.com/notes-on-setting-up-claude-desktop-mcp-servers/) - Troubleshooting common issues
- [VS Code MCP Documentation](https://code.visualstudio.com/docs/copilot/chat/mcp-servers) - Official VS Code MCP server guide
- [Cursor MCP Documentation](https://docs.cursor.com/context/model-context-protocol) - Cursor IDE MCP setup
- [Cline Documentation](https://docs.cline.bot/mcp/configuring-mcp-servers) - Cline MCP configuration guide
- [Continue.dev Documentation](https://docs.continue.dev/reference) - Continue extension reference

### MCP Client Lists
- [Official MCP Clients](https://modelcontextprotocol.io/clients) - Complete list of 100+ MCP-compatible applications
- [Awesome MCP Clients](https://github.com/punkpeye/awesome-mcp-clients) - Community-curated list of MCP clients

## Feedback and Support

- [GitHub Issues](https://github.com/cloudposse/atmos/issues) - Report bugs or request features
- [MCP GitHub](https://github.com/modelcontextprotocol) - MCP protocol issues
