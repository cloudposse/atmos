---
title: GitHub User Authentication
sidebar_label: github/user
sidebar_class_name: provider
id: github-user
description: Authenticate as a GitHub user using OAuth Device Flow for secure CLI authentication
---

import Mermaid from '@theme/Mermaid'

# GitHub User Authentication

:::note Purpose
The `github/user` provider authenticates as a GitHub user using **OAuth Device Flow** or **Web Application Flow**, enabling secure browser-based authentication for CLI tools. Tokens are cached in your OS keychain for seamless re-authentication.

This provider uses the same OAuth App as the official GitHub CLI (`gh`).
:::

## Overview

GitHub User authentication provides:

- **Two OAuth Flows** - Choose between Device Flow (default) or Web Application Flow
- **Browser-based Authentication** - Secure OAuth without storing passwords
- **OS Keychain Integration** - Tokens stored securely in macOS Keychain, Windows Credential Manager, or Linux Secret Service
- **Configurable Scopes** - Request only the GitHub permissions you need
- **Automatic Token Caching** - Tokens cached for 8 hours by default
- **Git Credential Helper** - Use with `git` commands automatically

## Authentication Flow

<Mermaid chart={`
sequenceDiagram
    participant User
    participant Atmos
    participant Keychain as OS Keychain
    participant GitHub
    participant Browser

    User->>Atmos: atmos auth login -i github-user
    Atmos->>Keychain: Check for cached token

    alt Token exists and valid
        Keychain-->>Atmos: Return cached token
        Atmos-->>User: ✓ Already authenticated
    else No token or expired
        Atmos->>GitHub: Request device code
        GitHub-->>Atmos: device_code + user_code
        Atmos-->>User: Visit github.com/login/device<br/>Enter code: ABCD-1234

        User->>Browser: Navigate to URL
        Browser->>GitHub: Enter user_code
        GitHub-->>User: Authorize app

        loop Poll for authorization
            Atmos->>GitHub: Check if user authorized
            GitHub-->>Atmos: authorization_pending
        end

        GitHub-->>Atmos: access_token
        Atmos->>Keychain: Store token (8h lifetime)
        Atmos-->>User: ✓ Authentication successful
    end
`} />

## Choosing Between Device and Web Flow

### Device Flow (Default)

**Best for:**
- Remote/SSH sessions
- Headless systems
- Docker containers
- CI/CD environments
- Systems where browser access is limited

**How it works:**
1. Atmos displays a verification URL and code
2. User manually visits the URL in any browser
3. User enters the code to authorize
4. Atmos polls GitHub until authorized

**Pros:**
- Works anywhere with network access
- Browser can be on a different device
- No local HTTP server required
- More secure for remote scenarios

### Web Application Flow

**Best for:**
- Local development workstations
- Interactive sessions with browser access
- Faster authentication experience

**How it works:**
1. Atmos starts a local HTTP server on `http://127.0.0.1:<random-port>`
2. Browser opens automatically to GitHub authorization page
3. User authorizes the app
4. GitHub redirects back to local server with authorization code
5. Local server exchanges code for token

**Pros:**
- Automatic browser opening
- Faster - no manual code entry
- Seamless user experience
- One-click authorization

**Cons:**
- Requires local browser access
- Won't work in SSH/remote sessions
- Needs available local port

## Configuration

### Provider Configuration

```yaml
auth:
  providers:
    github-user:
      kind: github/user
      flow_type: device  # Optional: "device" (default) or "web"
      # Client credentials are optional - uses GitHub CLI OAuth App by default
      client_id: "178c6fc778ccc68e1d6a"  # Optional: Custom GitHub OAuth App Client ID
      client_secret: "..."  # Optional: Required for web flow if using custom client_id
      scopes:  # Optional
        - repo
        - read:org
        - workflow
      token_lifetime: 8h  # Optional, default 8h
```

### Identity Configuration

```yaml
auth:
  identities:
    my-github:
      kind: github/user
      via:
        provider: github-user
```

## Parameters

<dl>
  <dt>`flow_type`</dt>
  <dd>
    **Optional** - OAuth flow type: `device` (default) or `web`.

    - **Device Flow** (`device`): Displays a code for manual browser entry. Works on remote/headless systems.
    - **Web Application Flow** (`web`): Opens browser automatically with local callback server. More streamlined for local development.

    Default: `device`
  </dd>

  <dt>`client_id`</dt>
  <dd>
    **Optional** - GitHub OAuth App Client ID.

    If not specified, Atmos uses the **GitHub CLI OAuth App** (`178c6fc778ccc68e1d6a`), the same OAuth App used by the official `gh` CLI tool. This provides a zero-configuration setup identical to `gh auth login`.

    Source: [GitHub CLI source code](https://github.com/cli/cli/blob/trunk/internal/authflow/flow.go)

    You can override this with your own OAuth App for custom scopes or organizational requirements.
  </dd>

  <dt>`client_secret`</dt>
  <dd>
    **Optional** - GitHub OAuth App Client Secret (required for Web Application Flow if using custom `client_id`).

    If not specified, Atmos uses the **GitHub CLI OAuth App client secret**, which is publicly available in the GitHub CLI source code. This is safe for native/CLI applications where the redirect URI (`http://127.0.0.1`) provides the security boundary rather than the client secret.

    **Note**: Only required for `web` flow. Device Flow does not use client secrets.
  </dd>

  <dt>`scopes`</dt>
  <dd>Array of GitHub OAuth scopes to request (optional, defaults to minimal read access)</dd>

  <dt>`token_lifetime`</dt>
  <dd>Token cache lifetime (optional, default: `8h`)</dd>
</dl>

## OAuth Scopes

Choose only the scopes your workflows require:

### Repository Access
- `repo` - Full control of private repositories
- `public_repo` - Access to public repositories only

### Organization Access
- `read:org` - Read organization membership
- `write:org` - Full control of orgs and teams
- `admin:org` - Full org management

### Workflows & Packages
- `workflow` - Update GitHub Actions workflow files
- `write:packages` - Upload packages to GitHub Packages
- `read:packages` - Download packages
- `delete:packages` - Delete packages

### User Profile
- `user` - Update user profile
- `user:email` - Access user email addresses
- `user:follow` - Follow/unfollow users

### Other Permissions
- `gist` - Write access to gists
- `notifications` - Access notifications
- `delete_repo` - Delete repositories
- `project` - Full control of projects
- `codespace` - Full control of codespaces

See [GitHub's OAuth scopes documentation](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/scopes-for-oauth-apps) for complete details.

## Usage

### First-Time Authentication

```shell
atmos auth login -i my-github
```

**Output:**
```
To authenticate with GitHub:
1. Visit: https://github.com/login/device
2. Enter code: ABCD-1234

Waiting for authentication...
✓ Successfully authenticated
```

### Using with Commands

```shell
# Use with gh CLI
atmos auth exec -i my-github -- gh repo list cloudposse

# Use with Terraform
atmos auth exec -i my-github -- terraform plan

# Use with git operations
atmos auth exec -i my-github -- git clone https://github.com/private/repo.git

# Export for scripts
eval "$(atmos auth env -i my-github)"
gh api user
```

### Git Credential Helper

Configure Atmos as a Git credential helper to automatically provide authentication for HTTPS git operations:

```shell
git config --global credential.helper '!atmos auth git-credential'
```

Now git will automatically use your Atmos GitHub identity:

```shell
git clone https://github.com/private/repo.git  # Automatically authenticated
git push origin main                            # No manual token needed
```

### Check Authentication Status

```shell
atmos auth whoami -i my-github
```

**Output:**
```yaml
identity: my-github
provider: github-user
authenticated: true
token_expires: 2025-10-20T22:00:00Z
```

### Logout and Revoke Token

```shell
atmos auth logout -i my-github
```

To fully revoke the token, visit: https://github.com/settings/tokens

## Creating a Custom GitHub OAuth App (Optional)

:::note Default OAuth App
Atmos provides a built-in OAuth App for zero-configuration setup. You only need to create a custom OAuth App if you require:
- Custom scopes beyond the default OAuth App permissions
- Organization-specific requirements or policies
- Audit trail under your organization's name
:::

To create a custom GitHub OAuth App:

1. Navigate to **GitHub Settings** → **Developer settings** → **OAuth Apps**
2. Click **New OAuth App**
3. Configure:
   - **Application name**: `Atmos CLI (Custom)`
   - **Homepage URL**: `https://atmos.tools`
   - **Authorization callback URL**: Leave empty (Device Flow doesn't use callbacks)
4. Click **Register application**
5. Note your **Client ID** (starts with `Iv1.` or `Iv23.`)
6. **Do not generate a client secret** - Device Flow doesn't require it
7. Add the Client ID to your provider configuration:

```yaml
auth:
  providers:
    github-user:
      kind: github/user
      client_id: "Iv1.your-custom-client-id"  # Your custom OAuth App
```

## Security Considerations

### Token Storage

Tokens are stored in your OS keychain:
- **macOS**: Keychain Access (`security` command)
- **Windows**: Credential Manager
- **Linux**: Secret Service (GNOME Keyring or KWallet)

Tokens are encrypted at rest and never written to disk in plain text.

### Token Lifetime

Tokens expire after 8 hours by default. When expired, Atmos will automatically prompt you to re-authenticate.

### Scope Minimization

Only request scopes your workflows actually need. For example:
- **Read-only operations**: Use `public_repo`, `read:org`
- **CI/CD deployments**: Use `repo`, `workflow`
- **Package publishing**: Add `write:packages`

### Environment Variables

Tokens are exposed as:
- `GITHUB_TOKEN` - Standard GitHub token variable
- `GH_TOKEN` - GitHub CLI token variable

These are set automatically by `atmos auth exec` and `atmos auth env`.

## Comparison with ghtkn

Atmos GitHub authentication is inspired by [ghtkn](https://github.com/suzuki-shunsuke/ghtkn), an excellent standalone tool for GitHub token management. Key differences:

| Feature | Atmos | ghtkn |
|---------|-------|-------|
| **Integration** | Built into Atmos | Standalone CLI |
| **Use Case** | Infrastructure workflows | General GitHub operations |
| **Identity Management** | Multi-identity support | Single token |
| **OS Keychain** | ✅ Yes | ✅ Yes |
| **Git Credential Helper** | ✅ Yes | ✅ Yes |
| **Token Lifecycle** | Integrated with `atmos auth` | Independent |

**Recommendation**: Use ghtkn if you need standalone GitHub token management. Use Atmos `github/user` if you're already using Atmos for infrastructure workflows and want unified authentication.

## Troubleshooting

### "Token not found in keychain"

The token has expired or been deleted. Re-authenticate:

```shell
atmos auth login -i my-github
```

### "Failed to store token in keychain"

Keychain access may be denied. On macOS:

```shell
# Grant terminal access to keychain
security unlock-keychain ~/Library/Keychains/login.keychain-db
```

### "Device code expired"

You took too long to authorize. Device codes expire after 15 minutes. Start over:

```shell
atmos auth login -i my-github
```

### "Insufficient scope"

Your token doesn't have the required permissions. Update `scopes` in your provider configuration and re-authenticate.

## Examples

### Personal Development (Zero-Config)

```yaml
auth:
  providers:
    github-personal:
      kind: github/user
      # No client_id needed - uses official Atmos OAuth App
      scopes:
        - repo
        - read:org

  identities:
    dev:
      kind: github/user
      default: true
      via:
        provider: github-personal
```

```shell
# Authenticate once
atmos auth login -i dev

# Use everywhere
atmos terraform apply vpc -s prod
gh repo list
git push origin main
```

### CI/CD Pipeline

```yaml
# .github/workflows/deploy.yml
name: Deploy Infrastructure

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Atmos
        uses: cloudposse/github-action-setup-atmos@v2

      - name: Authenticate GitHub
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # GitHub Actions provides GITHUB_TOKEN automatically
          # Use with Atmos
          atmos auth login -i ci

      - name: Deploy
        run: |
          atmos terraform apply vpc -s prod
```

## Related

- [GitHub App Authentication](/cli/commands/auth/providers/github-app) - For automation and bots
- [GitHub OIDC Authentication](/cli/commands/auth/providers/github-oidc) - For GitHub Actions
- [`atmos auth login`](/cli/commands/auth/login) - Authenticate with providers
- [`atmos auth exec`](/cli/commands/auth/exec) - Execute commands with identity
- [`atmos auth whoami`](/cli/commands/auth/whoami) - Check authentication status
