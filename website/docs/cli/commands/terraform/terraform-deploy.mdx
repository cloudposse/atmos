---
title: atmos terraform deploy
sidebar_label: deploy
sidebar_class_name: command
id: deploy
---
import Screengrab from '@site/src/components/Screengrab'
import Terminal from '@site/src/components/Terminal'

:::note purpose
Use this command to execute `terraform apply -auto-approve` on an Atmos component in an Atmos stack.
:::

<Screengrab title="atmos terraform deploy --help" slug="atmos-terraform-deploy--help" />

## Usage

Execute the `terraform deploy` subcommand like this:

```shell
atmos terraform deploy <component> -s <stack>
```

- `atmos terraform deploy` command supports `--deploy-run-init=true|false` flag to enable/disable running `terraform init` before executing the
  command

- `atmos terraform deploy` command automatically sets `-auto-approve` flag when running `terraform apply`

- `atmos terraform deploy` command supports `--from-plan` flag. If the flag is specified, the command will use the planfile previously generated
  by `atmos terraform plan` command instead of generating a new planfile, e.g. `atmos terraform deploy <component> -s <stack> --from-plan`. Note that
  in this case, the planfile name is in the format supported by Atmos and is saved to the component's folder

- `atmos terraform deploy` command supports `--planfile` flag to specify the path to a planfile. The `--planfile` flag should be used instead of the
  planfile argument in the native `terraform apply <planfile>` command. For example, you can execute the command
  `atmos terraform plan <component> -s <stack> -out=<FILE>`, which will save the generated plan to a file on disk,
  and then execute the command `atmos terraform deploy <component> -s <stack> --planfile <FILE>` to apply the previously generated planfile

See [all flags](#flags).

:::tip
Run `atmos terraform deploy --help` to see all the available options
:::

## Configuration

Configure default behavior for `terraform deploy` in your `atmos.yaml`:

```yaml
components:
  terraform:
    # Configure if terraform init should run before deploy
    deploy_run_init: true

    # Auto-generate backend configuration
    auto_generate_backend_file: true

    # Process Go templates in stack manifests
    process_templates: true

    # Process YAML functions in stack manifests
    process_functions: true
```

These settings can also be controlled via environment variables:
```shell
export ATMOS_COMPONENTS_TERRAFORM_DEPLOY_RUN_INIT=true
export ATMOS_COMPONENTS_TERRAFORM_AUTO_GENERATE_BACKEND_FILE=true
export ATMOS_COMPONENTS_TERRAFORM_PROCESS_TEMPLATES=true
export ATMOS_COMPONENTS_TERRAFORM_PROCESS_FUNCTIONS=true
```

## Examples

### Simple Example

Deploy the `top-level-component1` using the configuration specified in the `tenant1-ue2-dev` stack. This command explicitly targets a stack, which defines the environment and region settings for the deployment.

```shell
atmos terraform deploy top-level-component1 --stack tenant1-ue2-dev
```

### Planfiles

Deploy `top-level-component1` based on a previously generated execution plan. The `-s` flag specifies the `tenant1-ue2-dev` stack, and `--from-plan` indicates that the deploy should proceed with the plan that was previously created, ensuring that the deployment matches the plan's specifications.

```shell
atmos terraform deploy top-level-component1 -s tenant1-ue2-dev --from-plan
```

Or use `-s` for a specific execution plan file located at `<path_to_planfile>` to ensure precision in what is deployed.

```shell
atmos terraform deploy top-level-component1 -s tenant1-ue2-dev --planfile <path_to_planfile>
```

### Targeting Specific Stages

This demonstrates how Atmos can be used to deploy infrastructure components, like a VPC, specifying the stack to ensure the deployment occurs within the correct environment and configuration context.

```shell
atmos terraform deploy infra/vpc -s tenant1-ue2-staging
atmos terraform deploy test/test-component -s tenant1-ue2-dev
atmos terraform deploy test/test-component-override-2 -s tenant2-ue2-prod
atmos terraform deploy test/test-component-override-3 -s tenant1-ue2-dev
```

## Arguments

<dl>
    <dt>`component` <em>(required)</em></dt>
    <dd>
        Atmos terraform component.
    </dd>
</dl>

## Flags

<dl>
    <dt>`--stack` <em>(alias `-s`)</em> <em>(required)</em></dt>
    <dd>
        Atmos stack.
    </dd>

    <dt>`--dry-run` <em>(optional)</em></dt>
    <dd>
        Dry run.

        ```shell
        atmos terraform deploy <component> -s <stack> --dry-run=true
        ```
    </dd>

    <dt>`--deploy-run-init` <em>(optional)</em></dt>
    <dd>
        Enable/disable running `terraform init` before executing the command.

        ```shell
        atmos terraform deploy <component> -s <stack> --deploy-run-init
        ```
    </dd>

    <dt>`--from-plan` <em>(optional)</em></dt>
    <dd>
        If the flag is specified, use the `planfile` previously generated by Atmos instead of generating a new `planfile`.
        The planfile name is in the format supported by Atmos and is saved to the component's folder.

        ```shell
        atmos terraform deploy <component> -s <stack> --from-plan
        ```
    </dd>

    <dt>`--planfile` <em>(optional)</em></dt>
    <dd>
        The path to a planfile. The `--planfile` flag should be used instead of the planfile argument in the native `terraform apply <planfile>` command .

        ```shell
        atmos terraform apply <component> -s <stack> --planfile <planfile>
        ```
    </dd>

    <dt>`--process-templates` <em>(optional)</em></dt>
    <dd>
        Enable/disable Go template processing in Atmos stack manifests when executing terraform commands.

        If the flag is not passed, template processing is enabled by default.

        ```shell
        atmos terraform deploy <component> -s <stack> --process-templates=false
        ```
    </dd>

    <dt>`--process-functions` <em>(optional)</em></dt>
    <dd>
        Enable/disable YAML functions processing in Atmos stack manifests<br/>when executing terraform commands.

        If the flag is not passed, YAML function processing is enabled by default.

        ```shell
        atmos terraform deploy <component> -s <stack> --process-functions=false
        ```
    </dd>

    <dt>`--skip` <em>(optional)</em></dt>
    <dd>
        Skip processing a specific Atmos YAML function in Atmos stacks manifests when executing terraform commands.

        To specify more than one function, use multiple `--skip` flags, or separate the functions with a comma.

        ```shell
        atmos terraform deploy <component> -s <stack> --skip=eval --skip=include
        atmos terraform deploy <component> -s <stack> --skip=terraform.output,include
        ```
    </dd>
</dl>

:::note

The `atmos terraform deploy` command supports all native `terraform apply` options described
in [Terraform apply options](https://developer.hashicorp.com/terraform/cli/commands/apply#apply-options), with the exception that a planfile argument
can't be provided on the command line. To use a previously generated planfile, use the `--from-plan` or `--planfile` command-line flags

:::
