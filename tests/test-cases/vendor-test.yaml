tests:
  - name: atmos vendor pull without configuration
    enabled: true
    description: ""
    workdir: "../"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
    expect:
      stderr:
        - "# Error"
        - "\\*\\*Error:\\*\\* Vendoring is not configured"
      exit_code: 1

  - name: atmos_vendor_pull
    short: false
    enabled: true
    description: "Ensure atmos vendor pull command executes without errors and files are present."
    workdir: "fixtures/scenarios/vendor"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
    preconditions:
      - "github_token"
    expect:
      file_exists:
        - "./components/terraform/github/stargazers/main/main.tf"
        - "./components/terraform/github/stargazers/main/outputs.tf"
        - "./components/terraform/github/stargazers/main/providers.tf"
        - "./components/terraform/github/stargazers/main/variables.tf"
        - "./components/terraform/github/stargazers/main/versions.tf"
        - "./components/terraform/test-components/main/main.tf"
        - "./components/terraform/test-components/main/README.md"
        - "./components/terraform/weather/main/main.tf"
        - "./components/terraform/weather/main/outputs.tf"
        - "./components/terraform/weather/main/providers.tf"
        - "./components/terraform/weather/main/variables.tf"
        - "./components/terraform/weather/main/versions.tf"
        - "./components/terraform/myapp2/main.tf"
        - "./components/terraform/myapp2/README.md"
        # From ghcr.io/cloudposse/atmos/tests/fixtures/components/terraform/mock:v0
        - "./components/terraform/myapp1/main.tf"
        - "./components/terraform/myapp1/README.md"
      exit_code: 0

  - name: atmos_vendor_pull_oci
    short: false
    enabled: true
    description: "Ensure 'atmos vendor pull --tags' command executes without errors and files are present."
    workdir: "fixtures/scenarios/vendor"
    clean: true
    command: "atmos"
    args:
      - "vendor"
      - "pull"
      - "--tags=oci"
    preconditions:
      - "github_token"
    expect:
      file_exists:
        # From ghcr.io/cloudposse/atmos/tests/fixtures/components/terraform/mock:v0
        - "./components/terraform/myapp1/main.tf"
        - "./components/terraform/myapp1/README.md"
      exit_code: 0

  # Tests for simple filename exclusions (without **/ prefix) - regression test for bug fix
  - name: atmos_vendor_simple_exclude
    short: false
    enabled: true
    description: "Test simple filename exclusion - 'README.md' excludes README.md without needing '**/README.md'"
    workdir: "fixtures/scenarios/vendor-simple-excludes"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
      - "--tags=simple"
    expect:
      file_exists:
        # main.tf should be included (matches **/* and not excluded)
        - "./components/terraform/simple-exclude/main.tf"
      file_not_exists:
        # README.md should be excluded by simple pattern "README.md"
        - "./components/terraform/simple-exclude/README.md"
      exit_code: 0

  - name: atmos_vendor_combined_exclude_include
    short: false
    enabled: true
    description: "Test combined include/exclude - include **/*.tf but exclude main.tf"
    workdir: "fixtures/scenarios/vendor-simple-excludes"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
      - "--tags=combined"
    expect:
      file_not_exists:
        # main.tf should be excluded by simple pattern "main.tf"
        - "./components/terraform/combined/main.tf"
        # README.md should be excluded because it doesn't match **/*.tf include
        - "./components/terraform/combined/README.md"
      exit_code: 0
