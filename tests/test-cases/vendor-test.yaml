tests:
  - name: atmos vendor pull without configuration
    enabled: true
    description: ""
    workdir: "../"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
    expect:
      stderr:
        - "Vendoring is not configured. To set up vendoring, please see https://atmos.tools/core-concepts/vendor/"
      exit_code: 1

  - name: atmos_vendor_pull
    enabled: true
    description: "Ensure atmos vendor pull command executes without errors and files are present."
    workdir: "fixtures/scenarios/vendor"
    command: "atmos"
    args:
      - "vendor"
      - "pull"
    expect:
      file_exists:
        - "./components/terraform/github/stargazers/main/main.tf"
        - "./components/terraform/github/stargazers/main/outputs.tf"
        - "./components/terraform/github/stargazers/main/providers.tf"
        - "./components/terraform/github/stargazers/main/variables.tf"
        - "./components/terraform/github/stargazers/main/versions.tf"
        # TODO
        # Revert to "main" once the mock component is merged into the main branch
        # https://github.com/cloudposse/atmos/pull/1213
        #- "./components/terraform/mock/main/main.tf"
        #- "./components/terraform/mock/main/README.md"
        - "./components/terraform/mock/chore/replace-mock-component/main.tf"
        - "./components/terraform/mock/chore/replace-mock-component/README.md"
        # All of the following use the mock component
        # From ghcr.io/cloudposse/atmos/tests/fixtures/components/terraform/mock:v0
        - "./components/terraform/test-components/main/main.tf"
        - "./components/terraform/test-components/main/README.md"
        - "./components/terraform/mock2/main.tf"
        - "./components/terraform/mock2/README.md"
        - "./components/terraform/mock1/main.tf"
        - "./components/terraform/mock1/README.md"
      exit_code: 0

  - name: atmos_vendor_pull_oci
    enabled: true
    description: "Ensure atmos vendor pull command executes without errors and files are present."
    workdir: "fixtures/scenarios/vendor"
    clean: true
    command: "atmos"
    args:
      - "vendor"
      - "pull"
      - "--tags=oci"
    expect:
      file_exists:
        # From ghcr.io/cloudposse/atmos/tests/fixtures/components/terraform/mock:v0
        - "./components/terraform/mock1/main.tf"
        - "./components/terraform/mock1/README.md"
      exit_code: 0
