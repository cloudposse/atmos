# yaml-language-server: $schema=https://raw.githubusercontent.com/cloudposse/atmos/refs/heads/main/tests/test-cases/schema.json
tests:
  - name: atmos circuit-breaker
    enabled: true
    snapshot: true
    description: "Ensure atmos breaks the infinite loop when shell depth exceeds maximum (10)."
    workdir: "fixtures/scenarios/complete/"
    command: "atmos"
    args:
      - "loop"
    expect:
      timeout: 1m
      diff: []
      stderr:
        - "ATMOS_SHLVL.*exceeds maximum allowed depth.*(\r?\n)+exit status 1(\r?\n)+exit status 1.*"
      exit_code: 1
