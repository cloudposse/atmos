{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "tests": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "The name of the test."
          },
          "enabled": {
            "type": "boolean",
            "description": "Whether the test is enabled or not."
          },
          "tty": {
            "type": "boolean",
            "description": "Whether to run the test with a TTY."
          },
          "description": {
            "type": "string",
            "description": "A short description of the test."
          },
          "workdir": {
            "type": "string",
            "description": "The working directory for the test."
          },
          "command": {
            "type": "string",
            "description": "The command to execute."
          },
          "args": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "The arguments to pass to the command.",
            "default": []
          },
          "clean": {
            "type": "boolean",
            "description": "Whether to clean the working directory before running the test."
          },
          "snapshot": {
            "type": "boolean",
            "description": "Whether to enable snapshot comparison for this test."
          },
          "expect": {
            "type": "object",
            "properties": {
              "stdout": {
                "type": "array",
                "items": {
                  "anyOf": [
                    { "type": "string" },
                    {
                      "type": "object",
                      "properties": {
                        "not": { "type": "string" }
                      },
                      "required": ["not"]
                    }
                  ]
                },
                "description": "Expected patterns in stdout."
              },
              "stderr": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Expected patterns in stderr."
              },
              "exit_code": {
                "type": "integer",
                "description": "Expected exit code of the command."
              },
              "timeout": {
                "type": "string",
                "description": "Timeout for the test, specified as a duration string (e.g., '10s', '5m')."
              },
              "diff": {
                "type": "array",
                "items": {
                  "anyOf": [
                    { "type": "string" },
                    {
                      "type": "object",
                      "properties": {
                        "not": { "type": "string" }
                      },
                      "required": ["not"]
                    }
                  ]
                },
                "description": "Expected differences (regex patterns) for the golden snapshot."
              },
              "file_exists": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "A list of files that must exist for the test to pass."
              }
            },
            "required": ["exit_code"],
            "description": "Expectations for the test.",
            "additionalProperties": false
          }
        },
        "required": ["name", "enabled", "workdir", "command", "expect"],
        "additionalProperties": false
      }
    }
  },
  "required": ["tests"],
  "additionalProperties": false
}
