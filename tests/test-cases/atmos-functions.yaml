tests:
  - name: terraform output function
    enabled: true
    tty: true
    description: "Ensure the !terraform.output function works."
    workdir: "fixtures/scenarios/atmos-functions/"
    command: "atmos"
    args:
       - "terraform"
       - "deploy"
       - "component-4"
       - "-s"
       - "nonprod"
    env:
      ATMOS_LOGS_LEVEL: Debug
    skip:
      # PTY not supported on windows
      os: !not windows
    expect:
      exit_code: 0
      stdout:
        - "Fetching baz output from component-3 in nonprod"
        - "Fetching foo output from component-1 in nonprod"
        - "Fetching bar output from component-2 in nonprod"
      stderr:
        - "^$"

  - name: terraform output function (no tty)
    enabled: true
    tty: false
    description: "Ensure the !terraform.output function works."
    workdir: "fixtures/scenarios/atmos-functions/"
    command: "atmos"
    args:
       - "terraform"
       - "deploy"
       - "component-4"
       - "-s"
       - "nonprod"
    env:
      ATMOS_LOGS_LEVEL: Debug
    expect:
      exit_code: 0
      stdout:
        - "Fetching baz output from component-3 in nonprod"
        - "Fetching foo output from component-1 in nonprod"
        - "Fetching bar output from component-2 in nonprod"

  - name: "!env function test"
    enabled: true
    tty: false
    description: "Ensure the !env function works."
    workdir: "fixtures/scenarios/atmos-functions/"
    command: "atmos"
    args:
      - "terraform"
      - "deploy"
      - "component-5"
      - "-s"
      - "nonprod"
    env:
      ATMOS_TEST_1: "test-env-and-terraform-output-functions"
    expect:
      exit_code: 0
      stdout:
        - "test-env-and-terraform-output-functions"

  - name: "!terraform.output from component with !env function test"
    enabled: true
    tty: false
    description: "Ensure !terraform.output from component with !env function works."
    workdir: "fixtures/scenarios/atmos-functions/"
    command: "atmos"
    args:
      - "describe"
      - "component"
      - "component-6"
      - "-s"
      - "nonprod"
    expect:
      exit_code: 0
      stdout:
        - "test-env-and-terraform-output-functions"
