# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json

import:
  - mixins/region

# Global locals for prod environment.
locals:
  namespace: "acme"
  environment: "prod"
  stage: "us-east-1"
  name_prefix: "{{ .locals.namespace }}-{{ .locals.environment }}"
  full_name: "{{ .locals.name_prefix }}-{{ .locals.stage }}"
  tags:
    Environment: "{{ .locals.environment }}"
    Namespace: "{{ .locals.namespace }}"

vars:
  environment: "{{ .locals.environment }}"
  stage: "{{ .locals.stage }}"

terraform:
  locals:
    tf_specific: "terraform-only"
    backend_bucket: "{{ .locals.namespace }}-{{ .locals.environment }}-tfstate"
  backend_type: s3
  backend:
    s3:
      encrypt: true
      bucket: "{{ .locals.backend_bucket }}"
      key: "terraform.tfstate"
      region: "{{ .locals.stage }}"

components:
  terraform:
    mock/primary:
      metadata:
        component: mock
      vars:
        # Use global and terraform-scope locals.
        app_name: "{{ .locals.name_prefix }}-mock-primary"
        bar: "{{ .locals.environment }}"
        bucket: "{{ .locals.backend_bucket }}"
        tags: "{{ .locals.tags }}"
