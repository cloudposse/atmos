# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json

import:
  - mixins/region/us-east-1
  - mixins/stage/network

components:
  terraform:

    vpc:
      metadata:
        component: mock
        # Lock the component so it doesn't get included in the affected list
        locked: true
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_vpc_ue1: '!env ATMOS_TEST_VPC_UE1'

    tgw/hub:
      metadata:
        component: mock
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_tgw_hub_ue1: '!env ATMOS_TEST_TGW_HUB_UE1'
      settings:
        depends_on:
          # `tgw/hub` depends on the `vpc` component in the same stack (same account, same region)
          1:
            component: vpc
            stack: "{{ .vars.environment }}-{{ .vars.stage }}"

    tgw/attachment:
      metadata:
        component: mock
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_tgw_attachment_ue1: '!env ATMOS_TEST_TGW_ATTACHMENT_UE1'
      settings:
        # `tgw/attachment` depends on the `vpc` and `tgw/hub` components in the same stack (same account, same region)
        depends_on:
          1:
            component: vpc
          2:
            component: tgw/hub
