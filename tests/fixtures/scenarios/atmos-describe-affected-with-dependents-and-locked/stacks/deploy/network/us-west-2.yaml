# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json

import:
  - mixins/region/us-west-2
  - mixins/stage/network

components:
  terraform:

    vpc:
      metadata:
        component: mock
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_vpc_uw2: '!env ATMOS_TEST_VPC_UW2'

    tgw/attachment:
      metadata:
        component: mock
        # Disable the component so it doesn't get included in the affected and dependent lists
        enabled: false
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_tgw_attachment_uw2: '!env ATMOS_TEST_TGW_ATTACHMENT_UW2'
      settings:
        depends_on:
          1:
            # `tgw/attachment` depends on the `vpc` component in the same stack (same account, same region)
            component: vpc
          2:
            # `tgw/attachment` depends on the `tgw/hub` components in the same account in `us-east-1` region
            component: tgw/hub
            stack: "ue1-{{ .vars.stage }}"

    tgw/cross-region-hub-connector:
      metadata:
        component: mock
        # Lock the component so it doesn't get included in the affected list
        locked: true
      vars:
        # Add !env function to detect if this stack is being processed
        env_test_tgw_cross_region_uw2: '!env ATMOS_TEST_TGW_CROSS_REGION_UW2'
      settings:
        depends_on:
          1:
            # `tgw/cross-region-hub-connector` depends on the `tgw/hub` components in the same account in `us-east-1` region
            component: tgw/hub
            stack: "ue1-{{ .vars.stage }}"
