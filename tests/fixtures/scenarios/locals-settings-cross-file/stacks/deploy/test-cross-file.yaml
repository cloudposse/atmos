# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json
#
# Test that locals CANNOT access settings from imported files.
# This file imports sandbox-dev which has settings.substage = "dev",
# but locals in THIS file should NOT be able to access those imported settings.
# The expected behavior is that {{ .settings.substage }} produces a template error
# because settings is not defined in THIS file (cross-file access is not supported).

import:
  - mixins/stage/sandbox-dev

# Locals attempting to access settings from imported file (should produce an error).
locals:
  # This should produce an error because settings.substage is defined in the
  # imported mixin, not in THIS file. Cross-file settings access is not supported.
  attempted_cross_file_domain: '{{ .settings.substage }}.example.com'

vars:
  stage: test-cross-file

components:
  terraform:
    cross-file-component:
      metadata:
        component: mock
      vars:
        # This will show what the local resolved to.
        domain: "{{ .locals.attempted_cross_file_domain }}"
