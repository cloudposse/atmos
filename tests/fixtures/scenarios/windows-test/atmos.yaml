# Atmos configuration for acme
#
# This file configures both:
# - Custom CLI commands (loaded from .atmos.d/)
# - Terraform components and stacks (loaded from atmos/)

base_path: .

# Enable experimental features (toolchain command)
settings:
  experimental: true

# ─────────────────────────────────────────────────────────────────────────────
# Toolchain - Managed CLI tools
# Install with: atmos toolchain install
# Reference: https://atmos.tools/cli/configuration/toolchain/
# ─────────────────────────────────────────────────────────────────────────────
toolchain:
  file_path: .tool-versions
  install_path: .tools
  aliases:
    helm: helm/helm
    kubectl: kubernetes-sigs/kubectl
    replicated: replicatedhq/replicated
    tofu: opentofu/opentofu
  registries:
    # Inline registry for tools not in Aqua
    - name: acme
      type: atmos
      priority: 100
      tools:
        # Replicated CLI - not in Aqua registry
        replicatedhq/replicated:
          type: github_release
          repo_owner: replicatedhq
          repo_name: replicated
          asset: 'replicated_{{trimV .Version}}_{{if eq .OS "darwin"}}darwin_all{{else}}{{.OS}}_{{.Arch}}{{end}}.tar.gz'
          files:
            - name: replicated
              src: replicated

components:
  terraform:
    # Use OpenTofu
    command: "tofu"
    base_path: "atmos/components/terraform"
    apply_auto_approve: false
    deploy_run_init: true
    init_run_reconfigure: true
    auto_generate_backend_file: true

aliases:
  tofu: terraform

stacks:
  base_path: "atmos/stacks"
  included_paths:
    - "acme/**/*"
  excluded_paths:
    - "**/_defaults.yaml"
    - "**/_config.yaml"
  # Stack name format, ex: ctx-usw2
  name_template: "{{.vars.namespace}}-{{.vars.environment}}"

templates:
  settings:
    enabled: true
    sprig:
      enabled: true
    gomplate:
      enabled: true
      timeout: 5

workflows:
  base_path: "atmos/stacks/workflows"
