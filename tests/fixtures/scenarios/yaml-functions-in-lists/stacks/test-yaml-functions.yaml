# Test stack for YAML functions in lists
# Uses the generic yaml-function-test component for testing various scenarios

vars:
  stage: test

components:
  terraform:
    # First component - provides outputs for other components to reference
    test-component-1:
      metadata:
        component: yaml-function-test
      vars:
        test_string: "component-1-string"
        test_number: 100
        test_bool: true
        string_list:
          - "item-1"
          - "item-2"
        string_map:
          key1: "value1"
          key2: "value2"
        nested_object:
          name: "test-object-1"
          count: 5
          active: true
          tags:
            - "tag1"
            - "tag2"
          metadata:
            env: "test"
            version: "1.0"

    # Second component - provides different outputs
    test-component-2:
      metadata:
        component: yaml-function-test
      vars:
        test_string: "component-2-string"
        test_number: 200
        test_bool: false
        number_list:
          - 10
          - 20
          - 30
        list_of_maps:
          - name: "first"
            value: "100"
          - name: "second"
            value: "200"

    # Third component - uses YAML functions in lists (test case)
    test-yaml-functions-in-lists:
      metadata:
        component: yaml-function-test
      vars:
        # Test case 1: List with multiple terraform.output functions
        function_results_list:
          - !terraform.output test-component-1 test test_string
          - !terraform.output test-component-2 test test_string
          - !terraform.output test-component-1 test test_number

        # Test case 2: Mixed list with static values and functions
        mixed_function_list:
          - "static-value-start"
          - !terraform.output test-component-1 test test_string
          - "static-value-middle"
          - !terraform.state test-component-2 test test_bool
          - "static-value-end"

        # Test case 3: List with different types of YAML functions
        string_list:
          - !terraform.state test-component-1 test test_string
          - !terraform.state test-component-2 test test_string
          - !env TEST_ENV_VAR

        # Test case 4: Map with YAML functions
        function_map_results:
          from_component_1: !terraform.output test-component-1 test test_string
          from_component_2: !terraform.output test-component-2 test test_string
          from_state: !terraform.state test-component-1 test test_number
          static_value: "hardcoded-value"

        # Test case 5: Complex nested structure with functions
        nested_object:
          name: !terraform.output test-component-1 test test_string
          count: 10
          active: !terraform.output test-component-2 test test_bool
          tags:
            - !terraform.output test-component-1 test test_string
            - "static-tag"
          metadata:
            source: !terraform.state test-component-1 test test_string
            version: "2.0"

    # Test case for the original reported issue (ECR ARNs scenario)
    # This simulates the user's specific use case
    test-list-concatenation:
      metadata:
        component: yaml-function-test
      vars:
        # This reproduces the exact pattern from the bug report
        # Multiple terraform.state calls in a list
        function_results_list:
          - !terraform.state test-component-1 test test_string
          - !terraform.state test-component-2 test test_string

        # Multiple terraform.output calls in a list
        string_list:
          - !terraform.output test-component-1 test test_string
          - !terraform.output test-component-1 test test_number
          - !terraform.output test-component-2 test test_string
