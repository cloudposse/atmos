base_path: ./
components:
  terraform:
    base_path: components/terraform
    apply_auto_approve: true
    append_user_agent: Atmos/test (Cloud Posse; +https://atmos.tools)
    deploy_run_init: true
    init_run_reconfigure: true
    auto_generate_backend_file: false
    command: terraform
    shell:
      prompt: ""
    init:
      pass_vars: false
    plan:
      skip_planfile: false
  helmfile:
    base_path: components/helmfile
    use_eks: true
    kubeconfig_path: /dev/shm
    helm_aws_profile_pattern: '{namespace}-{tenant}-gbl-{stage}-helm'
    cluster_name_pattern: '{namespace}-{tenant}-{environment}-{stage}-eks-cluster'
    command: ""
  packer:
    base_path: ""
    command: ""
stacks:
  base_path: stacks
  included_paths:
    - deploy/**/*
  excluded_paths:
    - '**/_defaults.yaml'
  name_pattern: '{dev}'
  name_template: ""
workflows:
  base_path: stacks/workflows
  list:
    format: ""
    columns: []
logs:
  file: /dev/stderr
  level: Debug
commands:
  - name: tf
    description: Execute 'terraform' commands
    env: []
    arguments: []
    flags: []
    component_config:
      component: ""
      stack: ""
    steps: []
    commands:
      - name: plan
        description: This command plans terraform components
        env:
          - key: ENV_VAR_1
            value: ENV_VAR_1_value
            valueCommand: ""
          - key: ENV_VAR_2
            value: ""
            valueCommand: echo ENV_VAR_2_value
        arguments:
          - name: component
            description: Name of the component
            required: false
            default: ""
        flags:
          - name: stack
            shorthand: s
            type: ""
            description: Name of the stack
            usage: ""
            required: true
            default: null
        component_config:
          component: ""
          stack: ""
        steps:
          - command: atmos terraform plan {{ .Arguments.component }} -s {{ .Flags.stack }}
            type: shell
        commands: []
        verbose: false
    verbose: false
  - name: terraform
    description: Execute 'terraform' commands
    env: []
    arguments: []
    flags: []
    component_config:
      component: ""
      stack: ""
    steps: []
    commands:
      - name: provision
        description: This command provisions terraform components
        env:
          - key: ATMOS_COMPONENT
            value: '{{ .Arguments.component }}'
            valueCommand: ""
          - key: ATMOS_STACK
            value: '{{ .Flags.stack }}'
            valueCommand: ""
        arguments:
          - name: component
            description: Name of the component
            required: false
            default: ""
        flags:
          - name: stack
            shorthand: s
            type: ""
            description: Name of the stack
            usage: ""
            required: true
            default: null
        component_config:
          component: ""
          stack: ""
        steps:
          - command: atmos terraform plan $ATMOS_COMPONENT -s $ATMOS_STACK
            type: shell
          - command: atmos terraform apply $ATMOS_COMPONENT -s $ATMOS_STACK
            type: shell
        commands: []
        verbose: false
    verbose: false
  - name: show
    description: Execute 'show' commands
    env: []
    arguments: []
    flags: []
    component_config:
      component: ""
      stack: ""
    steps: []
    commands:
      - name: component
        description: Execute 'show component' command
        env:
          - key: ATMOS_COMPONENT
            value: '{{ .Arguments.component }}'
            valueCommand: ""
          - key: ATMOS_STACK
            value: '{{ .Flags.stack }}'
            valueCommand: ""
          - key: ATMOS_TENANT
            value: '{{ .ComponentConfig.vars.tenant }}'
            valueCommand: ""
          - key: ATMOS_STAGE
            value: '{{ .ComponentConfig.vars.stage }}'
            valueCommand: ""
          - key: ATMOS_ENVIRONMENT
            value: '{{ .ComponentConfig.vars.environment }}'
            valueCommand: ""
          - key: ATMOS_IS_PROD
            value: '{{ .ComponentConfig.settings.config.is_prod }}'
            valueCommand: ""
        arguments:
          - name: component
            description: Name of the component
            required: false
            default: ""
        flags:
          - name: stack
            shorthand: s
            type: ""
            description: Name of the stack
            usage: ""
            required: true
            default: null
        component_config:
          component: '{{ .Arguments.component }}'
          stack: '{{ .Flags.stack }}'
        steps:
          - command: 'echo Atmos component from argument: "{{ .Arguments.component }}"'
            type: shell
          - command: 'echo ATMOS_COMPONENT: "$ATMOS_COMPONENT"'
            type: shell
          - command: 'echo Atmos stack: "{{ .Flags.stack }}"'
            type: shell
          - command: 'echo Terraform component: "{{ .ComponentConfig.component }}"'
            type: shell
          - command: 'echo Backend S3 bucket: "{{ .ComponentConfig.backend.bucket }}"'
            type: shell
          - command: 'echo Terraform workspace: "{{ .ComponentConfig.workspace }}"'
            type: shell
          - command: 'echo Namespace: "{{ .ComponentConfig.vars.namespace }}"'
            type: shell
          - command: 'echo Tenant: "{{ .ComponentConfig.vars.tenant }}"'
            type: shell
          - command: 'echo Environment: "{{ .ComponentConfig.vars.environment }}"'
            type: shell
          - command: 'echo Stage: "{{ .ComponentConfig.vars.stage }}"'
            type: shell
          - command: 'echo settings.spacelift.workspace_enabled: "{{ .ComponentConfig.settings.spacelift.workspace_enabled }}"'
            type: shell
          - command: 'echo Dependencies: "{{ .ComponentConfig.deps }}"'
            type: shell
          - command: 'echo settings.config.is_prod: "{{ .ComponentConfig.settings.config.is_prod }}"'
            type: shell
          - command: 'echo ATMOS_IS_PROD: "$ATMOS_IS_PROD"'
            type: shell
        commands: []
        verbose: false
    verbose: false
  - name: test
    description: Run all tests
    env: []
    arguments: []
    flags: []
    component_config:
      component: ""
      stack: ""
    steps:
      - command: atmos describe config
        type: shell
    commands: []
    verbose: false
integrations:
  atlantis:
    path: atlantis.yaml
    config_templates:
      config-1:
        version: 3
        automerge: true
        delete_source_branch_on_merge: true
        parallel_plan: true
        parallel_apply: true
        allowed_regexp_prefixes:
          - dev/
          - staging/
          - prod/
    project_templates:
      project-1:
        name: '{tenant}-{environment}-{stage}-{component}'
        workspace: '{workspace}'
        dir: '{component-path}'
        terraform_version: v1.2
        delete_source_branch_on_merge: true
        autoplan:
          enabled: true
          when_modified:
            - '**/*.tf'
            - varfiles/$PROJECT_NAME.tfvars.json
        apply_requirements:
          - approved
    workflow_templates:
      workflow-1:
        apply:
          steps:
            - run: terraform apply $PLANFILE
        plan:
          steps:
            - run: terraform init -input=false
            - run: terraform workspace select $WORKSPACE || terraform workspace new $WORKSPACE
            - run: terraform plan -input=false -refresh -out $PLANFILE -var-file varfiles/$PROJECT_NAME.tfvars.json
  github:
    gitops:
      infracost-enabled: false
      opentofu-version: 1.8.4
      terraform-version: 1.9.8
schemas:
  jsonschema:
    base_path: stacks/schemas/jsonschema
  opa:
    base_path: stacks/schemas/opa
templates:
  settings:
    enabled: true
    sprig:
      enabled: true
    gomplate:
      enabled: true
      timeout: 5
      datasources: {}
    evaluations: 1
settings:
  list_merge_strategy: replace
  terminal:
    max_width: 120
    pager: "false"
    unicode: true
    syntax_highlighting:
      enabled: true
      lexer: ""
      formatter: terminal
      theme: dracula
      line_numbers: true
      wrap: false
    color: true
    no_color: false
  markdown:
    document:
      color: ${colors.text}
    heading:
      color: ${colors.primary}
      bold: true
    strong:
      color: ${colors.secondary}
      bold: true
    emph:
      color: ${colors.muted}
      italic: true
    code_block:
      color: ${colors.secondary}
      margin: 1
    link:
      color: ${colors.primary}
      underline: true
  inject_github_token: true
  inject_bitbucket_token: true
  inject_gitlab_token: true
  pro:
    base_url: https://atmos-pro.com
    endpoint: api/v1
  telemetry:
    enabled: true
    endpoint: https://us.i.posthog.com
    token: phc_TEST_TOKEN_PLACEHOLDER
    logging: false
vendor:
  base_path: ./vendor.yaml
initialized: true
basePathAbsolute: /absolute/path/to/repo
stacksBaseAbsolutePath: /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports/stacks
includeStackAbsolutePaths:
  - /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports/stacks/deploy/**/*
excludeStackAbsolutePaths:
  - /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports/stacks/**/_defaults.yaml
terraformDirAbsolutePath: /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports/components/terraform
helmfileDirAbsolutePath: /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports/components/helmfile
packerDirAbsolutePath: /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports
default: false
version:
  check:
    enabled: true
    timeout: 1000
    frequency: 1h
validate:
  editorconfig:
    format: default
cli_config_path: /absolute/path/to/repo/tests/fixtures/scenarios/atmos-cli-imports
import:
  - https://raw.githubusercontent.com/cloudposse/atmos/refs/heads/main/atmos.yaml
  - configs.d/**/*
  - ./logs.yaml
docs:
  max-width: 0
  pagination: false
  generate:
    readme:
      base-dir: .
      input:
        - ./README.yaml
      template: https://raw.githubusercontent.com/cloudposse/.github/5a599e3b929f871f333cb9681a721d26b237d8de/README.md.gotmpl
      output: ./README.md
      terraform:
        source: src/
        format: markdown
        show_inputs: true
        show_outputs: true
        sort_by: name
        indent_level: 2

