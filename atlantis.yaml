version: 3
automerge: true
delete_source_branch_on_merge: true
parallel_plan: true
parallel_apply: true
allowed_regexp_prefixes:
- dev/
- staging/
- prod/
projects:
- name: tenant2-ue2-staging-test-test-component
  workspace: tenant2-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-staging-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-staging-test-test-component-override-2
  workspace: tenant2-ue2-staging-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-staging-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-staging-infra-vpc
  workspace: tenant2-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-staging-top-level-component1
  workspace: tenant2-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-test-test-component-override-2
  workspace: tenant1-ue2-test-1-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-infra-vpc
  workspace: tenant1-ue2-test-1
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-top-level-component1
  workspace: tenant1-ue2-test-1
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-test-1-test-test-component
  workspace: tenant1-ue2-test-1
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-test-test-component-override-2
  workspace: tenant2-ue2-dev-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-infra-vpc
  workspace: tenant2-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-top-level-component1
  workspace: tenant2-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-test-test-component
  workspace: tenant2-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-dev-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-top-level-component1
  workspace: tenant1-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-test-test-component
  workspace: tenant1-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-test-test-component-override-2
  workspace: tenant1-ue2-staging-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-staging-infra-vpc
  workspace: tenant1-ue2-staging
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-infra-vpc
  workspace: tenant2-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-top-level-component1
  workspace: tenant2-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-test-test-component
  workspace: tenant2-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant2-ue2-prod-test-test-component-override-2
  workspace: tenant2-ue2-prod-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-infra-vpc
  workspace: tenant1-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-vpc-new
  workspace: tenant1-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-infra-vpc
  workspace: tenant1-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-top-level-component1
  workspace: tenant1-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-test-test-component
  workspace: tenant1-ue2-dev
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-dev-test-test-component-override-2
  workspace: tenant1-ue2-dev-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-test-test-component-override-3
  workspace: test-component-override-3-workspace
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-infra-vpc
  workspace: tenant1-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/infra/vpc
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-top-level-component1
  workspace: tenant1-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/top-level-component1
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-test-test-component
  workspace: tenant1-ue2-prod
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-test-test-component-override
  workspace: test-component-override-workspace-override
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
- name: tenant1-ue2-prod-test-test-component-override-2
  workspace: tenant1-ue2-prod-test-test-component-override-2
  workflow: workflow-1
  dir: examples/complete/components/terraform/test/test-component
  terraform_version: v1.2
  delete_source_branch_on_merge: true
  autoplan:
    enabled: true
    when_modified:
    - '**/*.tf'
    - varfiles/$PROJECT_NAME.tfvars.json
    apply_requirements:
    - approved
workflows:
  workflow-1:
    apply:
      steps:
      - run: terraform apply $PLANFILE
    plan:
      steps:
      - run: terraform init -input=false
      - run: terraform workspace select $WORKSPACE
      - run: terraform plan -input=false -refresh -out $PLANFILE -var-file varfiles/$PROJECT_NAME.tfvars.json
