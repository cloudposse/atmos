name: 'Build CLI and attach to GitHub release'

on:
  release:
    types: [ published ]

  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  release:
    uses: cloudposse/.github/.github/workflows/shared-release-branches.yml@main
    secrets: inherit

  homebrew:
    name: "Bump Homebrew formula"
    runs-on: ubuntu-latest
    needs: release
    steps:
      - uses: mislav/bump-homebrew-formula-action@v3
        with:
          # A PR will be sent to github.com/Homebrew/homebrew-core to update this formula:
          formula-name: atmos
          formula-path: Formula/a/atmos.rb
        env:
          COMMITTER_TOKEN: ${{ secrets.GH_BOT_TOKEN }}
