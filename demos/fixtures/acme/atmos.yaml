# Acme Corp - Atmos Configuration
# Demo fixture for VHS demo videos

base_path: "."

components:
  terraform:
    base_path: "components/terraform"
    backend_type: local
    apply_auto_approve: false
    deploy_run_init: true
    init_run_reconfigure: true
    auto_generate_backend_file: true

stacks:
  base_path: "stacks"
  included_paths:
    - "orgs/**/*"
  excluded_paths:
    - "**/_defaults.yaml"
  name_pattern: "{tenant}-{stage}-{environment}"
  name_template: "{{ .vars.tenant }}-{{ .vars.stage }}-{{ .vars.environment }}"

logs:
  file: "/dev/stderr"
  level: Info

# Command aliases for faster workflows
aliases:
  tf: terraform
  tp: terraform plan
  ta: terraform apply
  ds: describe stacks
  dc: describe component
  ls: list stacks
  lc: list components

# Custom commands for common operations
commands:
  - name: deploy-stack
    description: "Deploy entire stack (vpc -> cluster -> api)"
    arguments:
      - name: stack
        description: "Target stack name"
        required: true
    steps:
      - "terraform apply vpc -s {{ .Arguments.stack }} --auto-approve"
      - "terraform apply cluster -s {{ .Arguments.stack }} --auto-approve"
      - "terraform apply api -s {{ .Arguments.stack }} --auto-approve"

  - name: plan-all
    description: "Plan all components in a stack"
    arguments:
      - name: stack
        description: "Target stack name"
        required: true
    steps:
      - "terraform plan vpc -s {{ .Arguments.stack }}"
      - "terraform plan cluster -s {{ .Arguments.stack }}"
      - "terraform plan database -s {{ .Arguments.stack }}"
      - "terraform plan api -s {{ .Arguments.stack }}"

  - name: validate-all
    description: "Validate all stacks"
    steps:
      - "validate stacks"

# Vendor configuration
vendor:
  base_path: "vendor.yaml"

# Workflow configuration
workflows:
  base_path: "workflows"

# Settings
settings:
  list_merge_strategy: replace

# Integrations
integrations:
  github:
    gitops:
      opentofu-version: 1.8.0
      terraform-version: 1.9.0
      infracost-enabled: false
      artifact-storage:
        region: us-east-2
        bucket: acme-gitops-artifacts
        table: acme-gitops-locks
        role: arn:aws:iam::111111111111:role/acme-gitops

# Schemas for validation (disabled for demo)
# schemas:
#   jsonschema:
#     base_path: "stacks/schemas/jsonschema"
#   opa:
#     base_path: "stacks/schemas/opa"
#   atmos:
#     manifest: "stacks/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json"
