job "terraform clean" {
  description = "Remove terraform planfiles and .terraform folder"

  parameter "component" {
    type        = string
    description = "Component"
  }

  # Use either `environment-stage` or `stack` to specify the configuration file for the component
  option "environment" {
    type        = string
    description = "Environment"
    short       = "e"
    default     = ""
  }

  option "stage" {
    type        = string
    description = "Stage"
    short       = "s"
    default     = ""
  }

  # Use either `environment-stage` or `stack` to specify the configuration file for the component
  option "stack" {
    type        = string
    description = "Stack"
    short       = "st"
    default     = ""
  }

  step "clean shell" {
    run "terraform shell" {
      component = param.component

      commands = [
        "rm -rf .terraform *.planfile"
      ]
    }
  }

  step "clean log" {
    run "echo" {
      message = "Removed .terraform folder and all planfiles"
    }
  }
}
